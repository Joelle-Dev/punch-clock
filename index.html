<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script>(function(){var d=new Date().getDay();document.documentElement.classList.add('theme-day-'+d);})();</script>
    <meta name="description" content="è½»é‡çº§æ‰“å¡è®°å½•åº”ç”¨">
    <meta name="theme-color" content="#FFFFFF">
    <!-- é¦–å±ç™½åº•ï¼Œå‡å°‘é»‘å± -->
    <style>html,body{background:#fff !important;}</style>
    <!-- iOS Safari PWA ä¼˜åŒ–ï¼šæ­£æ–¹å½¢å›¾æ ‡ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ç§‹ç‘¾æ‰“å¡">
    <title>æ‰“å¡è®°å½•</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“…</text></svg>">
    <!-- ä¸»å±å¹•å›¾æ ‡ï¼šä½¿ç”¨ icon-512.png.jpg -->
    <link rel="apple-touch-icon" href="./icon-512.png.jpg">
    <link rel="stylesheet" href="./style.css">
    <link rel="manifest" href="./manifest.webmanifest">
    <style>
        .splash-screen {
            position: fixed;
            inset: 0;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
            transition: opacity 0.35s ease;
        }
        .splash-screen.splash-hidden {
            opacity: 0;
            pointer-events: none;
        }
        .splash-title {
            font-size: 20px;
            color: #4F46E5;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .splash-subtitle {
            font-size: 14px;
            color: #6B7280;
        }
    </style>
</head>
<body>
    
    <div id="splash" class="splash-screen">
        <div class="splash-title">æ½˜ç§‹ç‘¾</div>
        <div class="splash-subtitle">å¥¥åˆ©ç»™</div>
    </div>

    <div class="app-shell">
        <header class="top-banner">
            <span class="top-banner-text">æ½˜ç§‹ç‘¾ï¼Œä½ ä»Šå¤©çœŸå¥½çœ‹ âœ¨</span>
            <button type="button" class="top-banner-theme-btn" id="themeBtn" aria-label="ä¸»é¢˜é¢œè‰²">
                <span class="top-banner-theme-icon" aria-hidden="true">ğŸ¨</span>
            </button>
        </header>
        <!-- æ—¥å¸¸æ‰“å¡é¢æ¿ -->
        <div id="panelPunch" class="tab-panel active">
        <header class="app-header">
            <div class="stats-row">
                <div class="stat-card">
                    <span class="stat-value" id="todayCount">0</span>
                    <span class="stat-label">ä»Šæ—¥</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="streakCount">0</span>
                    <span class="stat-label">è¿ç»­</span>
                </div>
            </div>
        </header>

        <main class="app-main">
            <section class="type-section" aria-label="é€‰æ‹©ç±»å‹">
                <div class="type-tabs" role="tablist">
                    <button class="type-tab active" data-type="toilet" role="tab">å¦‚å•</button>
                    <button class="type-tab" data-type="meal" role="tab">é¥­å¦</button>
                    <button class="type-tab" data-type="fitness" role="tab">å¥èº«</button>
                    <button class="type-tab" data-type="other" role="tab">å…¶ä»–</button>
                </div>
            </section>

            <section class="punch-section">
                <div class="praise-wrap" id="praiseWrap" aria-live="polite">
                    <span class="praise-text" id="praiseText"></span>
                    <span class="praise-hearts" id="praiseHearts"></span>
                </div>
                <button id="punchBtn" class="punch-button" type="button" aria-label="æ‰“å¡">
                    <span class="punch-icon" aria-hidden="true">ğŸ‘Š</span>
                    <span class="punch-text">æ‰“å¡</span>
                </button>
                <p class="last-punch" id="lastPunchTime">æš‚æ— æ‰“å¡è®°å½•</p>
            </section>

            <section class="heatmap-section" aria-label="æœ¬æœˆæ‰“å¡">
                <h2 class="heatmap-title">æœ¬æœˆæ‰“å¡</h2>
                <div id="heatmapContainer" class="heatmap-container"></div>
            </section>

            <section class="history-section" aria-label="å†å²è®°å½•">
                <div class="history-header">
                    <h2 class="history-title">è®°å½•</h2>
                    <div class="filter-tabs" role="tablist">
                        <button class="filter-tab active" data-filter="all" role="tab">å…¨éƒ¨</button>
                        <button class="filter-tab" data-filter="today" role="tab">ä»Šå¤©</button>
                        <button class="filter-tab" data-filter="week" role="tab">æœ¬å‘¨</button>
                        <button class="filter-tab" data-filter="month" role="tab">æœ¬æœˆ</button>
                    </div>
                </div>
                <div class="history-type-tabs">
                    <button class="history-type-tab active" data-history-type="all">å…¨éƒ¨</button>
                    <button class="history-type-tab" data-history-type="toilet">å¦‚å•</button>
                    <button class="history-type-tab" data-history-type="meal">é¥­å¦</button>
                    <button class="history-type-tab" data-history-type="fitness">å¥èº«</button>
                    <button class="history-type-tab" data-history-type="other">å…¶ä»–</button>
                </div>
                <div class="history-list" id="historyList">
                    <!-- æ‰“å¡è®°å½•å°†åŠ¨æ€æ’å…¥è¿™é‡Œ -->
                </div>
            </section>
        </main>

        </div>
        <!-- å§¨å¦ˆæ‰“å¡é¢æ¿ -->
        <div id="panelPeriod" class="tab-panel" hidden>
            <header class="app-header period-header">
                <div class="header-inner">
                    <h1 class="app-title">å§¨å¦ˆæ‰“å¡</h1>
                    <p class="app-subtitle">è®°å½•ç»æœŸï¼Œé¢„æµ‹ä¸‹æ¬¡</p>
                </div>
            </header>
            <main class="period-main">
                <div class="period-status" id="periodStatus">
                    <!-- å½“å‰çŠ¶æ€ï¼šæœªå¼€å§‹ / è¿›è¡Œä¸­ / å·²ç»“æŸ -->
                </div>
                <div class="period-actions">
                    <button type="button" id="periodStartBtn" class="period-btn period-btn-start">æ¥çš„ç¬¬ä¸€å¤©</button>
                    <button type="button" id="periodEndBtn" class="period-btn period-btn-end">ç»“æŸäº†</button>
                </div>
                <div class="period-prediction" id="periodPrediction">
                    <!-- é¢„æµ‹ä¸‹æ¬¡å¼€å§‹æ—¥ -->
                </div>
                <section class="period-history-section">
                    <div class="period-history-header">
                        <h2 class="period-history-title">å†å²è®°å½•</h2>
                        <div class="period-history-actions">
                            <button type="button" id="periodImportBtn" class="period-export-btn">å¯¼å…¥</button>
                            <button type="button" id="periodExportBtn" class="period-export-btn">å¯¼å‡º</button>
                        </div>
                    </div>
                    <input type="file" id="periodFileInput" accept=".csv,text/csv" hidden>
                    <div class="period-history-list" id="periodHistoryList">
                        <!-- ç»æœŸå†å²åˆ—è¡¨ -->
                    </div>
                </section>
            </main>
        </div>

        <div class="actions-fab" id="actionsFab">
            <div class="actions-menu" id="actionsMenu">
                <button id="exportBtn" class="action-btn">å¯¼å‡ºæ•°æ®</button>
                <button id="importBtn" class="action-btn">å¯¼å…¥æ•°æ®</button>
                <button id="clearBtn" class="action-btn danger">æ¸…ç©ºè®°å½•</button>
            </div>
            <input type="file" id="punchFileInput" accept=".csv,text/csv" hidden>
            <button type="button" class="actions-fab-toggle" id="actionsFabToggle" aria-label="æ›´å¤šæ“ä½œ">
                <span class="fab-icon">â‹¯</span>
            </button>
        </div>

        <nav class="tab-bar" role="tablist" aria-label="ä¸»åŠŸèƒ½">
            <button type="button" class="tab-bar-item active" data-tab="punch" role="tab" aria-selected="true">
                <span class="tab-bar-icon">âœ¨</span>
                <span class="tab-bar-label">æ‰“å¡</span>
            </button>
            <button type="button" class="tab-bar-item" data-tab="period" role="tab" aria-selected="false">
                <span class="tab-bar-icon">ğŸŒ™</span>
                <span class="tab-bar-label">ç§‹ç‘¾å®å®å§¨å¦ˆ</span>
            </button>
        </nav>
    </div>

    <div id="confirmModal" class="modal-backdrop" hidden>
        <div class="modal">
            <div class="modal-title" id="modalTitle">ç¡®è®¤åˆ é™¤</div>
            <div class="modal-message" id="modalMessage"></div>
            <div class="modal-actions">
                <button id="modalCancel" class="modal-btn">å–æ¶ˆ</button>
                <button id="modalConfirm" class="modal-btn danger">åˆ é™¤</button>
            </div>
        </div>
    </div>

    <div id="achievementToast" class="achievement-toast" aria-live="polite">
        <span class="achievement-toast-icon"></span>
        <span class="achievement-toast-title"></span>
    </div>

    <div id="achievementModal" class="modal-backdrop theme-modal" hidden>
        <div class="modal theme-modal-inner achievement-modal-inner">
            <div class="theme-modal-title">æˆå°±</div>
            <div id="achievementList" class="achievement-list"></div>
            <button type="button" class="theme-modal-close" id="achievementModalClose" aria-label="å…³é—­">Ã—</button>
        </div>
    </div>

    <div id="themeModal" class="modal-backdrop theme-modal" hidden>
        <div class="modal theme-modal-inner">
            <div class="theme-modal-title">ä¸»é¢˜é¢œè‰²</div>
            <div class="theme-modal-row">
                <label class="theme-label">è‡ªé€‰é¢œè‰²</label>
                <input type="color" id="themeColorInput" class="theme-color-input" value="#6B7FD7" title="é€‰æ‹©ä¸»é¢˜è‰²">
            </div>
            <div class="theme-modal-actions">
                <button type="button" id="themeResetBtn" class="theme-reset-btn">é‡ç½®ä¸ºæŒ‰æ˜ŸæœŸè‡ªåŠ¨</button>
                <button type="button" class="theme-help-btn" id="themeHelpBtn" aria-label="ä½¿ç”¨è¯´æ˜">?</button>
            </div>
            <div id="themeHelpBlock" class="theme-help-block" hidden>
                <p class="theme-help-title">ä½¿ç”¨è¯´æ˜</p>
                <p class="theme-help-text">é»˜è®¤æŒ‰å‘¨ä¸€åˆ°å‘¨æ—¥è‡ªåŠ¨åˆ‡æ¢ä¸ƒç§æŸ”å’Œä¸»é¢˜è‰²ï¼ˆå‘¨æ—¥æš–æã€å‘¨ä¸€ç´«è“ã€å‘¨äºŒç»¿ã€å‘¨ä¸‰æ©™ã€å‘¨å››ç²‰ã€å‘¨äº”ç´«ã€å‘¨å…­é’ç»¿ï¼‰ã€‚</p>
                <p class="theme-help-text">ç§‹ç‘¾å®å®å¯ä»¥åœ¨æ­¤é€‰æ‹©è‡ªå·±å–œæ¬¢çš„é¢œè‰²ï¼Œé€‰ä¸­åå°†å›ºå®šä½¿ç”¨è¯¥ä¸»é¢˜ï¼›ç‚¹å‡»ã€Œé‡ç½®ä¸ºæŒ‰æ˜ŸæœŸè‡ªåŠ¨ã€å³å¯æ¢å¤æŒ‰æ˜ŸæœŸè‡ªåŠ¨åˆ‡æ¢ã€‚</p>
            </div>
            <button type="button" class="theme-modal-close" id="themeModalClose" aria-label="å…³é—­">Ã—</button>
        </div>
    </div>

    <script type="module" src="./app.js"></script>
    <script>
        // å¯åŠ¨é¡µï¼šç­‰é¦–å¸§ç™½åº•æ¸²æŸ“åå†æ·¡å‡ºï¼Œå‡å°‘é»‘â†’ç™½é—ªçƒ
        (function () {
            var splash = document.getElementById('splash');
            if (!splash) return;
            var hide = function () {
                splash.classList.add('splash-hidden');
                setTimeout(function () {
                    splash.style.display = 'none';
                }, 400);
            };
            if (document.readyState === 'complete') {
                setTimeout(hide, 500);
            } else {
                window.addEventListener('load', function () { setTimeout(hide, 500); });
            }
        })();
    </script>
</body>
</html>

