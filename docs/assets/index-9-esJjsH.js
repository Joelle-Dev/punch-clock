(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=t(r);fetch(r.href,c)}})();const g=document.getElementById("punchBtn"),G=document.getElementById("todayCount"),Y=document.getElementById("streakCount"),A=document.getElementById("lastPunchTime"),C=document.getElementById("historyList"),P=document.querySelectorAll(".filter-tab"),z=document.getElementById("exportBtn"),Q=document.getElementById("clearBtn"),q=document.querySelectorAll(".type-tab"),F=document.querySelectorAll(".history-type-tab"),m=document.getElementById("confirmModal"),V=document.getElementById("modalTitle"),X=document.getElementById("modalMessage"),H=document.getElementById("modalCancel"),j=document.getElementById("modalConfirm"),E=document.getElementById("praiseToast"),R="punch_records_v1";function Z(){try{const n=localStorage.getItem(R);if(!n)return[];const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch(n){return console.error("Failed to load records",n),[]}}function x(n){localStorage.setItem(R,JSON.stringify(n))}function u(n){return n.toISOString().slice(0,10)}function _(n){const e=new Map;return n.forEach(t=>{e.has(t.dateKey)||e.set(t.dateKey,[]),e.get(t.dateKey).push(t)}),Array.from(e.entries()).sort((t,o)=>t[0]<o[0]?1:-1).map(([t,o])=>({dateKey:t,recs:o}))}function L(n){const e=String(n.getHours()).padStart(2,"0"),t=String(n.getMinutes()).padStart(2,"0"),o=String(n.getSeconds()).padStart(2,"0");return`${e}:${t}:${o}`}function N(n){const[e,t,o]=n.split("-");return`${e}å¹´${Number(t)}æœˆ${Number(o)}æ—¥`}function ee(n){const e=u(new Date);return n.filter(t=>t.dateKey===e).length}function te(n){if(!n.length)return 0;const e=_(n);let t=0,o=new Date,r=u(o);for(let c=0;c<e.length;c++){const{dateKey:i}=e[c];if(i===r)t++,o.setDate(o.getDate()-1),r=u(o);else break}return t}function J(n){switch(n){case"fitness":return"å¥èº«";case"toilet":return"å¦‚å•";case"meal":return"é¥­å¦";default:return"å…¶ä»–"}}function ne(n,e){const t=new Date,o=u(t);if(e==="today")return n.filter(r=>r.dateKey===o);if(e==="week"){const r=new Date;r.setDate(t.getDate()-6);const c=u(r);return n.filter(i=>i.dateKey>=c)}if(e==="month"){const[r,c]=o.split("-"),i=`${r}-${c}`;return n.filter(a=>a.dateKey.startsWith(i))}return n}function l(n,e="all"){if(G.textContent=String(ee(n)),Y.textContent=String(te(n)),!n.length)A.textContent="æš‚æ— æ‰“å¡è®°å½•";else{const i=n[n.length-1],a=new Date(i.timestamp);A.textContent=`æœ€åä¸€æ¬¡ï¼š${N(i.dateKey)} ${L(a)}`}const t=ne(n,e);if(C.innerHTML="",!t.length){C.innerHTML=`
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“</div>
        <p>è¿˜æ²¡æœ‰æ‰“å¡è®°å½•</p>
      </div>
    `;return}const o=document.createDocumentFragment(),r=s.historyType||"all";["toilet","meal","fitness","other"].forEach(i=>{if(r!=="all"&&r!==i)return;const a=t.filter(f=>(f.type||"other")===i);if(!a.length)return;const d=document.createElement("div");d.className=`history-type-block history-type-block-${i}`;const T=document.createElement("div");T.className="history-item";const w=document.createElement("div"),B=document.createElement("div");B.className="history-date",B.textContent=J(i);const b=document.createElement("div");b.className="history-time",b.textContent=`å…± ${a.length} æ¬¡`,w.appendChild(B),w.appendChild(b),T.appendChild(w),d.appendChild(T),_(a.slice().sort((f,D)=>f.timestamp-D.timestamp)).forEach(({dateKey:f,recs:D})=>{const S=document.createElement("div");S.className="history-item";const K=document.createElement("div"),$=document.createElement("div");$.className="history-date",$.textContent=N(f);const k=document.createElement("div");k.className="history-time-list",D.forEach(O=>{const W=new Date(O.timestamp),y=document.createElement("div");y.className="time-chip";const M=document.createElement("span");M.textContent=L(W);const h=document.createElement("button");h.className="time-delete-btn",h.textContent="åˆ ",h.setAttribute("data-id",O.id),y.appendChild(M),y.appendChild(h),k.appendChild(y)}),K.appendChild($),K.appendChild(k),S.appendChild(K),d.appendChild(S)}),o.appendChild(d)}),C.appendChild(o)}let s={records:[],filter:"all",currentType:"fitness",historyType:"all"},p=null,I=null;function U(n){const{title:e,message:t,onConfirm:o}=n;if(!m){window.confirm(t)&&typeof o=="function"&&o();return}V.textContent=e||"ç¡®è®¤æ“ä½œ",X.textContent=t||"",p=typeof o=="function"?o:null,m.hidden=!1}function v(){m&&(m.hidden=!0),p=null}function re(){s.records=Z(),q.forEach(e=>{e.addEventListener("click",()=>{q.forEach(t=>t.classList.remove("active")),e.classList.add("active"),s.currentType=e.dataset.type||"fitness",l(s.records,s.filter)})});const n=document.querySelector(".type-tab.active");n&&(s.currentType=n.dataset.type||"fitness"),l(s.records,s.filter),g.addEventListener("click",()=>{const e=new Date,t={id:`${e.getTime()}-${Math.random().toString(36).slice(2,6)}`,timestamp:e.getTime(),dateKey:u(e),type:s.currentType};s.records.push(t),x(s.records),l(s.records,s.filter),g.classList.remove("punch-button-bounce"),g.offsetWidth,g.classList.add("punch-button-bounce"),E&&(E.textContent="æ½˜ç§‹ç‘¾çœŸæ£’ï¼",E.classList.add("show"),I&&clearTimeout(I),I=setTimeout(()=>{E.classList.remove("show")},1600))}),P.forEach(e=>{e.addEventListener("click",()=>{P.forEach(t=>t.classList.remove("active")),e.classList.add("active"),s.filter=e.dataset.filter||"all",l(s.records,s.filter)})}),F.forEach(e=>{e.addEventListener("click",()=>{F.forEach(t=>t.classList.remove("active")),e.classList.add("active"),s.historyType=e.dataset.historyType||"all",l(s.records,s.filter)})}),H&&H.addEventListener("click",()=>{v()}),j&&j.addEventListener("click",()=>{if(p){const e=p;p=null,v(),e()}else v()}),m&&m.addEventListener("click",e=>{e.target===m&&v()}),C.addEventListener("click",e=>{const t=e.target;if(!(t instanceof HTMLElement)||!t.classList.contains("time-delete-btn"))return;const o=t.getAttribute("data-id");if(!o)return;const r=s.records.find(a=>a.id===o);if(!r)return;const c=J(r.type||"other"),i=new Date(r.timestamp);U({title:"åˆ é™¤æ‰“å¡è®°å½•",message:`ç¡®å®šåˆ é™¤ã€${c}ã€‘åœ¨ã€${N(r.dateKey)} ${L(i)}ã€‘çš„è¿™æ¡æ‰“å¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,onConfirm:()=>{s.records=s.records.filter(a=>a.id!==o),x(s.records),l(s.records,s.filter)}})}),z.addEventListener("click",()=>{if(!s.records.length){alert("æš‚æ— æ•°æ®å¯å¯¼å‡º");return}const e=["ç±»å‹","æ—¥æœŸ","æ—¶é—´","æ—¶é—´æˆ³"],t=s.records.slice().sort((a,d)=>a.timestamp-d.timestamp).map(a=>{const d=new Date(a.timestamp);return[a.type||"other",a.dateKey,L(d),String(a.timestamp)]}),o=[e,...t].map(a=>a.map(d=>`"${d}"`).join(",")).join(`
`),r=new Blob([o],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(r),i=document.createElement("a");i.href=c,i.download=`æ‰“å¡è®°å½•-å…¨éƒ¨-${u(new Date)}.csv`,i.click(),URL.revokeObjectURL(c)}),Q.addEventListener("click",()=>{s.records.length&&U({title:"æ¸…ç©ºæ‰€æœ‰è®°å½•",message:"ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ‰“å¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚",onConfirm:()=>{s.records=[],x(s.records),l(s.records,s.filter)}})})}document.addEventListener("DOMContentLoaded",re);
