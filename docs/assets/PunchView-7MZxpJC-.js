import{o as i,j as u,a4 as ot,r as x,i as mt,a5 as Ft,c as q,w as O,a as t,F as N,l as V,a6 as ft,t as f,n as at,k as lt,d as ht,B as wt,e as it,h as F,_ as _t,G as Ct,u as bt,a7 as xt,m as j,a8 as yt,H as dt,I as vt,a9 as At,aa as Lt}from"./index-B2tpYLd0.js";/* empty css              */import{u as Et}from"./useDoubleTapHint-Coh7qc3X.js";import{_ as Bt}from"./BaseModal-DksTFind.js";import{_ as Mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as Dt,a as Tt}from"./index-CahSuBjs.js";import"./use-id-DpUp3XII.js";const St=["width","height"],$t={__name:"ToiletIcon",props:{size:{type:[Number,String],default:24}},setup(d){return(m,r)=>(i(),u("svg",{width:d.size,height:d.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...r[0]||(r[0]=[ot('<g transform="translate(48 48) scale(1.5) translate(-48 -48)"><rect x="26" y="22" rx="6" ry="6" width="28" height="22" fill="#FFFFFF" stroke="#B8C4FF" stroke-width="2"></rect><circle cx="50" cy="28" r="2" fill="#B8C4FF"></circle><rect x="30" y="36" rx="10" ry="10" width="36" height="26" fill="#FFFFFF" stroke="#B8C4FF" stroke-width="2"></rect><ellipse cx="48" cy="50" rx="10" ry="7" fill="#D6E4FF"></ellipse><circle cx="40" cy="44" r="2" fill="#7D8FFF"></circle><circle cx="56" cy="44" r="2" fill="#7D8FFF"></circle><path d="M42 48 C 45 52, 51 52, 54 48" stroke="#FF9BB3" stroke-width="2" fill="none" stroke-linecap="round"></path><path d="M36 62 H60 L56 74 H40 Z" fill="#FFFFFF" stroke="#B8C4FF" stroke-width="2"></path><path d="M32 40 C34 36, 38 34, 42 34" stroke="#EDF1FF" stroke-width="3" fill="none" stroke-linecap="round"></path></g>',1)])],8,St))}},Nt=["width","height"],zt={__name:"MealIcon",props:{size:{type:[Number,String],default:24}},setup(d){return(m,r)=>(i(),u("svg",{width:d.size,height:d.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...r[0]||(r[0]=[ot(`<g transform="translate(48 52) scale(1.7) translate(-48 -52)"><path d="M32 54
           C 32 50, 36 46, 48 46
           C 60 46, 64 50, 64 54
           C 64 58, 60 62, 48 62
           C 36 62, 32 58, 32 54 Z" fill="#FFFFFF" stroke="#E2C39B" stroke-width="2"></path><path d="M40 62
           C 41 64, 43 66, 48 66
           C 53 66, 55 64, 56 62" fill="#FFFFFF" stroke="#E2C39B" stroke-width="2" stroke-linecap="round"></path><path d="M34 52
           C 36 46, 41 42, 48 42
           C 55 42, 60 46, 62 52
           C 58 54, 53 55.5, 48 56
           C 43 55.5, 38 54.5, 34 52 Z" fill="#FFFFFF" stroke="#F0E4D0" stroke-width="1.4"></path><path d="M40 47 C42.5 46,45 46,47.5 47" stroke="#F7EFE2" stroke-width="1.8" stroke-linecap="round"></path><path d="M49 46.8 C51.5 46,54 46,56 47.2" stroke="#F7EFE2" stroke-width="1.8" stroke-linecap="round"></path><path d="M45 51.5
           C 47.3 50.8, 49.7 50.8, 52 51.7
           C 52.4 53, 52 54.2, 50.9 55.2
           C 49 55.5, 47.5 55.2, 46 54.2
           C 45.5 53.4, 45.3 52.5, 45 51.5 Z" fill="#FFE3A3" stroke="#F2C774" stroke-width="1"></path><path d="M38 53
           C 36.5 52, 35.5 50.5, 36.3 49
           C 37.5 47.5, 39.3 47.4, 41 48.4
           C 42 50, 41.5 51.5, 40 52.8 Z" fill="#B7E08C" stroke="#8FBF63" stroke-width="1"></path><g transform="rotate(-25 60 40)"><rect x="52" y="38" width="24" height="2.6" rx="1.3" fill="#F0B15A"></rect><rect x="54" y="35.6" width="24" height="2.6" rx="1.3" fill="#F0B15A"></rect></g><circle cx="44" cy="58" r="1.3" fill="#D0834A"></circle><circle cx="52" cy="58" r="1.3" fill="#D0834A"></circle><path d="M45.5 60.5 C 47 61.8, 49 61.8, 50.5 60.5" stroke="#FF6B9D" stroke-width="1.5" fill="none" stroke-linecap="round"></path></g>`,1)])],8,Nt))}},Rt=["width","height"],It={__name:"FitnessIcon",props:{size:{type:[Number,String],default:24}},setup(d){return(m,r)=>(i(),u("svg",{width:d.size,height:d.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...r[0]||(r[0]=[ot(`<g transform="translate(48 48) scale(1.6) translate(-48 -48)"><g transform="translate(0, 4)"><path d="M28 54
             C 30 46, 36 40, 44 38
             C 50 36, 54 38, 56 42
             C 58 46, 56 50, 52 52
             C 48 54, 44 56, 40 58
             C 35 60, 30 60, 28 58
             Z" fill="#FFE0C2" stroke="#E2B194" stroke-width="2" stroke-linejoin="round"></path><path d="M34 50 C 40 46, 48 45, 53 48" stroke="#FFD2AE" stroke-width="2.2" fill="none" stroke-linecap="round"></path><path d="M38 56
             C 44 56, 50 54, 54 50
             C 56 48, 58 46, 60 46
             C 62 46, 64 48, 64 50
             C 64 52, 62 54, 60 55
             C 55 58, 48 60, 42 60
             C 40 60, 38 58, 38 56 Z" fill="#FFE0C2" stroke="#E2B194" stroke-width="2" stroke-linejoin="round"></path><rect x="56" y="46" width="8" height="6" rx="3" fill="#4D7CFF"></rect><path d="M60 40
             C 56 40, 54 42, 54 45
             L 54 50
             C 54 52, 56 54, 58 54
             L 62 54
             C 65 54, 68 52, 68 49
             C 68 46, 66 44, 64 44
             L 62 44
             C 62 42, 61 40, 60 40 Z" fill="#FFE0C2" stroke="#E2B194" stroke-width="2" stroke-linejoin="round"></path></g><g transform="translate(0, 0) rotate(-15 66 26)"><rect x="58" y="24" width="16" height="4" rx="2" fill="#B7C4FF"></rect><rect x="54" y="22" width="4" height="8" rx="2" fill="#8FA1FF"></rect><rect x="74" y="22" width="4" height="8" rx="2" fill="#8FA1FF"></rect></g><circle cx="50" cy="70" r="7.5" fill="#FFFFFF" stroke="#C8D0F8" stroke-width="1.5"></circle><path d="M47 68 Q48 67 49 68" stroke="#5A5A7A" stroke-width="1.4" fill="none" stroke-linecap="round"></path><path d="M51 68 Q52 67 53 68" stroke="#5A5A7A" stroke-width="1.4" fill="none" stroke-linecap="round"></path><path d="M47.5 71 C 49 72.5, 51 72.5, 52.5 71" stroke="#FF6B9D" stroke-width="1.5" fill="none" stroke-linecap="round"></path></g>`,1)])],8,Rt))}},Pt=["width","height"],Ut={__name:"OtherIcon",props:{size:{type:[Number,String],default:24}},setup(d){return(m,r)=>(i(),u("svg",{width:d.size,height:d.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...r[0]||(r[0]=[ot('<g transform="translate(48 48) scale(1.18) translate(-48 -48)"><path d="M48 20 L52 36 L68 36 L56 46 L60 62 L48 52 L36 62 L40 46 L28 36 L44 36 Z" fill="#FFFFFF" stroke="#D4A3FF" stroke-width="2"></path><path d="M48 32 L49 40 L57 40 L51 44 L53 52 L48 48 L43 52 L45 44 L39 40 L47 40 Z" fill="#E8C5FF"></path><circle cx="44" cy="42" r="2" fill="#B47FFF"></circle><circle cx="52" cy="42" r="2" fill="#B47FFF"></circle><path d="M46 46 C 47 49, 49 49, 50 46" stroke="#FF6B9D" stroke-width="2" fill="none" stroke-linecap="round"></path><circle cx="30" cy="30" r="2" fill="#E8C5FF"></circle><circle cx="66" cy="30" r="2" fill="#E8C5FF"></circle><circle cx="30" cy="66" r="2" fill="#E8C5FF"></circle><circle cx="66" cy="66" r="2" fill="#E8C5FF"></circle></g>',1)])],8,Pt))}};function jt(d,m){const r=String(m).trim()?String(m).trim():"ç§‹ç‘¾";switch(d){case"toilet":return r+"åˆæ‹‰ç²‘ç²‘å•¦ï½";case"meal":return r+"çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½";case"fitness":return r+"å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½";default:return r+"çœŸæ£’ï½"}}function Ht(){try{typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(15)}catch{}}const Vt={class:"punch-success-wave-wrap","aria-hidden":"true"},Zt={class:"punch-success-wave punch-success-wave--main"},Yt={class:"punch-success-wave punch-success-wave--mirror"},qt={class:"punch-success-message"},H=25,Ot={__name:"PunchSuccessModal",props:{open:Boolean,message:{type:String,default:""}},emits:["update:open"],setup(d,{emit:m}){const r="./music2.mp3",K="./music2.lrc",Z=d,W=m,Q=F({get:()=>Z.open,set:e=>W("update:open",e)}),A=x(Array(H).fill(.08)),G=x(null),z=x([]),J=F(()=>z.value.map(e=>e.text)),M=x(-1);let L=null,w=null,R=null,g=null,k=null,C=null,_=!1;function D(e){const o=e.split(`
`),c=[];for(const a of o){const h=a.trim();if(!h||/^\[(ti|ar|al|by|offset):/i.test(h))continue;const y=/\[(\d+):(\d+(?:\.\d+)?)\]/g;let b;const E=[];let S=0;for(;(b=y.exec(h))!==null;){const P=Number(b[1]||0),st=Number(b[2]||0);E.push(P*60+st),S=y.lastIndex}if(!E.length)continue;const B=h.slice(S).trim();B&&E.forEach(P=>{c.push({time:P,text:B})})}return c.sort((a,h)=>a.time-h.time),c}async function I(){if(!(_||!K))try{const e=await fetch(K);if(!e.ok)return;const o=await e.text(),c=D(o);c.length&&(z.value=c,_=!0)}catch{}}function T(){if(R!=null&&(cancelAnimationFrame(R),R=null),g){try{g.disconnect()}catch{}g=null}A.value=Array(H).fill(.08),k!=null&&(cancelAnimationFrame(k),k=null),M.value=-1,C=null}function X(){if(!w)return;const e=new Uint8Array(w.frequencyBinCount);w.getByteFrequencyData(e);const o=H,c=Math.max(1,Math.floor(e.length/o)),a=[];for(let h=0;h<o;h++){let y=0;const b=h*c,E=Math.min(b+c,e.length);for(let B=b;B<E;B++)y+=e[B];const S=y/(E-b);a.push(Math.min(1,S/255*1.2+.08))}A.value=a,R=requestAnimationFrame(X)}function tt(e){if(!L||!z.value.length)return;C=L.currentTime,k!=null&&(cancelAnimationFrame(k),k=null);const o=()=>{if(!L||C==null)return;const c=L.currentTime-C;if(c<0){k=requestAnimationFrame(o);return}const a=z.value;let h=a.length-1;for(let y=0;y<a.length&&a[y].time<=c;y++)h=y;M.value=h,k=requestAnimationFrame(o)};o()}mt(M,async()=>{await _t();const e=G.value;if(!e)return;const o=e.querySelector(".punch-success-lyric-line--active");o&&o.scrollIntoView({block:"center",behavior:"smooth"})});async function Y(){T();try{const e=L||new(window.AudioContext||window.webkitAudioContext);L=e,e.state==="suspended"&&await e.resume(),await I();const c=await(await fetch(r)).arrayBuffer(),a=await e.decodeAudioData(c);g=e.createBufferSource(),g.buffer=a,w=e.createAnalyser(),w.fftSize=256,w.smoothingTimeConstant=.7,g.connect(w),w.connect(e.destination),g.onended=()=>T(),g.start(0),X(),tt(a.duration||0)}catch{A.value=Array(H).fill(.08)}}mt(()=>Z.open,e=>{e?Y():T()},{immediate:!0}),Ft(T);function et(){W("update:open",!1)}return(e,o)=>{const c=wt;return i(),q(Bt,{open:Q.value,"onUpdate:open":o[0]||(o[0]=a=>Q.value=a),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:O(()=>[o[2]||(o[2]=t("div",{class:"punch-success-header"},[t("span",{class:"punch-success-label"},"æ‰“å¡æˆåŠŸ")],-1)),t("div",Vt,[t("div",Zt,[(i(),u(N,null,V(H,a=>t("span",{key:"main-"+a,class:"wave-bar",style:ft({transform:`scaleY(${A.value[a-1]})`})},null,4)),64))]),t("div",Yt,[(i(),u(N,null,V(H,a=>t("span",{key:"mirror-"+a,class:"wave-bar wave-bar--mirror",style:ft({transform:`scaleY(${A.value[a-1]})`})},null,4)),64))])]),t("div",qt,f(d.message),1),J.value.length?(i(),u("div",{key:0,class:"punch-success-lyrics",ref_key:"lyricsContainerRef",ref:G},[(i(!0),u(N,null,V(J.value,(a,h)=>(i(),u("p",{key:h,class:at(["punch-success-lyric-line",{"punch-success-lyric-line--active":h===M.value}])},f(a),3))),128))],512)):lt("",!0),ht(c,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:et},{default:O(()=>[...o[1]||(o[1]=[it("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},Kt=Mt(Ot,[["__scopeId","data-v-6f7afceb"]]),Wt={class:"tab-panel active punch-panel"},Qt={class:"app-header"},Gt={class:"stats-row"},Jt={class:"stat-card"},Xt={class:"stat-value"},te={class:"stat-card"},ee={class:"stat-value"},se={class:"stat-value"},ne={key:0,class:"stat-achievement-hint"},ae={class:"app-main"},le={class:"type-section","aria-label":"é€‰æ‹©ç±»å‹"},ie={class:"type-tab-title"},oe={class:"type-tab-text"},re={class:"punch-button-inner"},ce={class:"punch-icon","aria-hidden":"true"},ue={key:0,class:"last-punch"},de={class:"last-punch-type"},he={class:"last-punch-date"},pe={key:1,class:"last-punch"},me={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},fe={class:"heatmap-container"},ye={class:"heatmap-grid"},ve={key:0,class:"heatmap-cell heatmap-cell-empty"},Fe=["title"],we="fitness",ge="ç§‹ç‘¾",ke=450,Be={__name:"PunchView",setup(d){var pt;const{records:m,todayCount:r,streak:K,lastRecord:Z,addRecord:W,getMonthHeatmap:Q}=Ct(),{unlockedList:A,achievements:G,checkAll:z}=bt(),{shouldSkipDueToDoubleTap:J}=Et(),M=dt("openAchievementModal",()=>{}),L=dt("showAchievementToast",()=>{}),w=dt("userName",x("")),R=["toilet","meal","fitness","other"],g=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],k=[{threshold:6,class:"heatmap-cell-4"},{threshold:4,class:"heatmap-cell-3"},{threshold:2,class:"heatmap-cell-2"},{threshold:1,class:"heatmap-cell-1"}],C=[{type:"toilet",label:"å¦‚å•",emoji:"ğŸš½",short:"å•",tint:"#4caf50",iconComponent:$t},{type:"meal",label:"é¥­å¦",emoji:"ğŸš",short:"é¥­",tint:"#ff9800",iconComponent:zt},{type:"fitness",label:"å¥èº«",emoji:"ğŸ’ª",short:"èº«",tint:"#2196f3",iconComponent:It},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0",iconComponent:Ut}].map(s=>({...s,tabTitle:`${s.emoji} ${s.short}`})),_=x(R.includes((pt=Z.value)==null?void 0:pt.type)?Z.value.type:we),D=x(!1),I=x(!1),T=x(""),X=F(()=>new Map(G.map(s=>[s.id,s]))),tt=F(()=>{var p;const s=A.value;if(!s.length)return"";const n=s[s.length-1];return((p=X.value.get(n))==null?void 0:p.title)??""}),Y=F(()=>C.find(s=>s.type===_.value)||C[0]),et=F(()=>r.value===0),e=F(()=>[`punch-button--${_.value}`,{"punch-button-bounce":D.value,"punch-button--first":et.value}]),o=F(()=>{var s;return`${((s=Y.value)==null?void 0:s.label)||""} æ‰“æˆ‘`}),c=F(()=>{if(r.value===0)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const s=vt().format("YYYY-MM-DD"),n=m.value.filter(v=>v.dateKey===s);if(!n.length)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const p=n.reduce((v,l)=>l.timestamp>v.timestamp?l:v),$=C.find(v=>v.type===(p.type||"other"));return{hasRecord:!0,typeLabel:($==null?void 0:$.label)??"å…¶ä»–",dateDisplay:Lt(p.dateKey),timeDisplay:At(p.timestamp)}}),a=F(()=>vt()),h=F(()=>{const s=a.value,n=s.year(),p=s.month()+1,$=Q(m.value,n,p),v=s.startOf("month"),l=v.daysInMonth(),rt=v.day(),ct=[];for(let U=0;U<rt;U++)ct.push({empty:!0});for(let U=1;U<=l;U++){const ut=`${n}-${String(p).padStart(2,"0")}-${String(U).padStart(2,"0")}`,nt=$[ut]||0,gt=b(nt),kt=nt?`${ut} æ‰“æˆ‘ ${nt} æ¬¡`:ut;ct.push({empty:!1,count:nt,level:gt,title:kt})}return ct});function y(s){return s==="meal"?28:24}function b(s){const n=k.find(p=>s>=p.threshold);return(n==null?void 0:n.class)??"heatmap-cell-0"}function E(){var s;return((s=w.value)==null?void 0:s.trim())||ge}function S(){m.value=[...m.value]}function B(){if(J(_.value))return;Ht();const s=E();T.value=jt(_.value,s),I.value=!0,W(_.value),D.value=!0,requestAnimationFrame(()=>{D.value=!1,document.body.offsetHeight,D.value=!0,setTimeout(()=>{D.value=!1},ke)}),setTimeout(()=>{z(m.value).forEach(p=>L(p))},0)}function P(){document.visibilityState==="visible"&&S()}function st(s){s.persisted&&S()}return xt(()=>{document.addEventListener("visibilitychange",P),window.addEventListener("pageshow",st)}),Ft(()=>{document.removeEventListener("visibilitychange",P),window.removeEventListener("pageshow",st)}),(s,n)=>{const p=Tt,$=Dt,v=wt;return i(),u("div",Wt,[t("header",Qt,[t("div",Gt,[t("div",Jt,[t("span",Xt,f(j(r)),1),n[3]||(n[3]=t("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),t("div",te,[t("span",ee,f(j(K)),1),n[4]||(n[4]=t("span",{class:"stat-label"},"è¿ç»­",-1))]),t("div",{class:"stat-card stat-card-achievement",onClick:n[0]||(n[0]=(...l)=>j(M)&&j(M)(...l))},[t("span",se,f(j(A).length),1),n[5]||(n[5]=t("span",{class:"stat-label"},"æˆå°±",-1)),tt.value?(i(),u("span",ne,f(tt.value),1)):lt("",!0)])])]),t("main",ae,[t("section",le,[ht($,{active:_.value,"onUpdate:active":n[1]||(n[1]=l=>_.value=l),shrink:""},{default:O(()=>[(i(!0),u(N,null,V(j(C),l=>(i(),q(p,{key:l.type,name:l.type},{title:O(()=>[t("span",ie,[(i(),q(yt(l.iconComponent),{size:y(l.type)},null,8,["size"])),t("span",oe,f(l.short),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["active"])]),t("section",{class:at(["punch-section",{"punch-section--first":et.value}]),"aria-label":"æ‰“å¡"},[ht(v,{type:"primary",round:"",size:"large",class:at(["punch-button",e.value]),"aria-label":o.value,onClick:B},{default:O(()=>[t("span",re,[t("span",ce,[Y.value?(i(),q(yt(Y.value.iconComponent),{key:0,size:40})):lt("",!0)]),n[6]||(n[6]=t("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),c.value.hasRecord?(i(),u("p",ue,[n[7]||(n[7]=it(" ä¸Šæ¬¡æ˜¯ ",-1)),t("span",de,f(c.value.typeLabel),1),n[8]||(n[8]=it(" ï½ ",-1)),t("span",he,f(c.value.dateDisplay),1),it(" "+f(c.value.timeDisplay),1)])):(i(),u("p",pe,f(c.value.text),1))],2),t("section",me,[n[9]||(n[9]=t("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),t("div",fe,[t("div",ye,[(i(),u(N,null,V(g,l=>t("span",{key:l,class:"heatmap-week-label"},f(l),1)),64)),(i(!0),u(N,null,V(h.value,(l,rt)=>(i(),u(N,{key:rt},[l.empty?(i(),u("span",ve)):(i(),u("span",{key:1,class:at(["heatmap-cell",l.level]),title:l.title},f(l.count||""),11,Fe))],64))),128))])])])]),I.value?(i(),q(Kt,{key:0,open:I.value,"onUpdate:open":n[2]||(n[2]=l=>I.value=l),message:T.value},null,8,["open","message"])):lt("",!0)])}}};export{Be as default};
