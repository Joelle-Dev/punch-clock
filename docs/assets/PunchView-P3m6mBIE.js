import{L as te,o as l,c as U,w as $,a as t,t as c,d as q,B as G,e as w,r as D,h as M,P as O,ac as se,a0 as ae,i,u,F as b,j as H,n as z,af as ne,ag as W,ah as oe,ai as le,ad as ce}from"./index-B6lK9Dpp.js";import{T as ie,a as ue}from"./index-B4aWtoJP.js";import{u as re}from"./useAchievements-ZV79T2-6.js";import{u as pe}from"./useDoubleTapHint-S_ILrpZc.js";import{_ as de}from"./BaseModal-Cj9NIWqo.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-id-BDOUpYTK.js";function he(_){switch(_){case"toilet":return"ç§‹ç‘¾åˆæ‹‰ç²‘ç²‘å•¦ï½ž";case"meal":return"ç§‹ç‘¾çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½ž";case"fitness":return"ç§‹ç‘¾å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½ž";default:return"ç§‹ç‘¾çœŸæ£’ï½ž"}}const fe={class:"punch-success-message"},ve={__name:"PunchSuccessModal",props:{open:Boolean,message:{type:String,default:""}},emits:["update:open"],setup(_,{emit:d}){const m=_,S=d,r=M({get:()=>m.open,set:o=>S("update:open",o)}),h=D(null),x=["â™¥","âœ¨","â˜…","â˜†","â€¢","â™¥","âœ¨","â˜…"],C=["celebrate-float","celebrate-twinkle","celebrate-rise"],j=["#ff6b9d","#e84c7a","#ffd700","#ffb347","#c2185b","#f8bbd9"];function g(){if(h.value){h.value.innerHTML="";for(let o=0;o<28;o++){const a=document.createElement("span");a.className="celebrate-item "+C[o%C.length],a.textContent=x[o%x.length],a.style.left=Math.random()*80+10+"%",a.style.top=Math.random()*80+10+"%",a.style.animationDelay=Math.random()*.8+"s",a.style.color=j[o%j.length],a.style.fontSize=12+Math.random()*12+"px",h.value.appendChild(a)}}}function B(){O(()=>{requestAnimationFrame(()=>{O(()=>{g(),setTimeout(g,80)})})})}function I(){S("update:open",!1)}return te(()=>m.open,o=>{o&&B()},{immediate:!0}),(o,a)=>{const f=G;return l(),U(de,{open:r.value,"onUpdate:open":a[0]||(a[0]=L=>r.value=L),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:$(()=>[t("div",{ref_key:"celebrationRef",ref:h,class:"punch-success-celebration","aria-hidden":"true"},null,512),t("div",fe,c(_.message),1),q(f,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:I},{default:$(()=>[...a[1]||(a[1]=[w("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},ye=me(ve,[["__scopeId","data-v-4d06afb7"]]),be={class:"tab-panel active punch-panel"},_e={class:"app-header"},ge={class:"stats-row"},ke={class:"stat-card"},Te={class:"stat-value"},we={class:"stat-card"},De={class:"stat-value"},Me={class:"stat-value"},Se={class:"app-main"},xe={class:"type-section","aria-label":"é€‰æ‹©ç±»åž‹"},Ce={class:"punch-button-inner"},je={class:"punch-icon","aria-hidden":"true"},Le={class:"last-punch"},Re={class:"last-punch-type"},Ae={class:"last-punch-date"},Pe={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},$e={class:"heatmap-container"},Be={class:"heatmap-grid"},Ee={key:0,class:"heatmap-cell heatmap-cell-empty"},Ne=["title"],Ke={__name:"PunchView",setup(_){var K;const{records:d,todayCount:m,streak:S,lastRecord:r,addRecord:h,getMonthHeatmap:x}=se(),{unlockedList:C,checkAll:j}=re(),g=W("openAchievementModal",()=>{}),B=W("showAchievementToast",()=>{}),o=D(["toilet","meal","fitness","other"].includes((K=r.value)==null?void 0:K.type)?r.value.type:"fitness"),a=D(!1),f=D(!1),L=D(""),{shouldSkipDueToDoubleTap:J}=pe(),R=[{type:"toilet",label:"å¦‚åŽ•",emoji:"ðŸš½",short:"åŽ•",tint:"#4caf50"},{type:"meal",label:"é¥­å¦",emoji:"ðŸš",short:"é¥­",tint:"#ff9800"},{type:"fitness",label:"å¥èº«",emoji:"ðŸ’ª",short:"èº«",tint:"#2196f3"},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0"}].map(s=>({...s,tabTitle:s.emoji+" "+s.short})),A=M(()=>R.find(s=>s.type===o.value)||R[0]);function Q(s){var e;return((e=R.find(v=>v.type===s))==null?void 0:e.label)??"å…¶ä»–"}const X=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],k=M(()=>{if(!r.value)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const s=r.value;return{hasRecord:!0,typeLabel:Q(s.type||"other"),dateDisplay:le(s.dateKey),timeDisplay:oe(s.timestamp)}}),Y=M(()=>ce()),Z=M(()=>{const s=Y.value,e=s.year(),v=s.month()+1,E=x(d.value,e,v),P=s.startOf("month"),n=P.daysInMonth(),N=P.day(),V=[];for(let y=0;y<N;y++)V.push({empty:!0});for(let y=1;y<=n;y++){const F=`${e}-${String(v).padStart(2,"0")}-${String(y).padStart(2,"0")}`,p=E[F]||0;let T="heatmap-cell-0";p>=6?T="heatmap-cell-4":p>=4?T="heatmap-cell-3":p>=2?T="heatmap-cell-2":p>=1&&(T="heatmap-cell-1"),V.push({empty:!1,count:p,level:T,title:p?`${F} æ‰“æˆ‘ ${p} æ¬¡`:F})}return V});function ee(){J(o.value)||(L.value=he(o.value),f.value=!0,h(o.value),a.value=!0,requestAnimationFrame(()=>{a.value=!1,document.body.offsetHeight,a.value=!0,setTimeout(()=>a.value=!1,450)}),setTimeout(()=>{j(d.value).forEach(e=>B(e))},0))}return ae(()=>{const s=()=>{d.value=[...d.value]};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&s()}),window.addEventListener("pageshow",e=>{e.persisted&&s()})}),(s,e)=>{const v=ue,E=ie,P=G;return l(),i("div",be,[t("header",_e,[t("div",ge,[t("div",ke,[t("span",Te,c(u(m)),1),e[3]||(e[3]=t("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),t("div",we,[t("span",De,c(u(S)),1),e[4]||(e[4]=t("span",{class:"stat-label"},"è¿žç»­",-1))]),t("div",{class:"stat-card stat-card-achievement",onClick:e[0]||(e[0]=(...n)=>u(g)&&u(g)(...n))},[t("span",Me,c(u(C).length),1),e[5]||(e[5]=t("span",{class:"stat-label"},"æˆå°±",-1))])])]),t("main",Se,[t("section",xe,[q(E,{active:o.value,"onUpdate:active":e[1]||(e[1]=n=>o.value=n),shrink:""},{default:$(()=>[(l(!0),i(b,null,H(u(R),n=>(l(),U(v,{key:n.type,name:n.type,title:n.tabTitle},null,8,["name","title"]))),128))]),_:1},8,["active"])]),t("section",{class:z(["punch-section",{"punch-section--first":u(m)===0}])},[q(P,{type:"primary",round:"",size:"large",class:z(["punch-button",["punch-button--"+o.value,{"punch-button-bounce":a.value},{"punch-button--first":u(m)===0}]]),"aria-label":A.value?A.value.emoji+" æ‰“æˆ‘":"æ‰“æˆ‘",onClick:ee},{default:$(()=>[t("span",Ce,[t("span",je,c(A.value?A.value.emoji:"ðŸ‘Š"),1),e[6]||(e[6]=t("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),t("p",Le,[k.value.hasRecord?(l(),i(b,{key:0},[e[7]||(e[7]=w("ä¸Šæ¬¡æ˜¯ ",-1)),t("span",Re,c(k.value.typeLabel),1),e[8]||(e[8]=w(" ï½ž ",-1)),t("span",Ae,c(k.value.dateDisplay),1),w(" "+c(k.value.timeDisplay),1)],64)):(l(),i(b,{key:1},[w(c(k.value.text),1)],64))])],2),t("section",Pe,[e[9]||(e[9]=t("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),t("div",$e,[t("div",Be,[(l(),i(b,null,H(X,n=>t("span",{key:n,class:"heatmap-week-label"},c(n),1)),64)),(l(!0),i(b,null,H(Z.value,(n,N)=>(l(),i(b,{key:N},[n.empty?(l(),i("span",Ee)):(l(),i("span",{key:1,class:z(["heatmap-cell",n.level]),title:n.title},c(n.count||""),11,Ne))],64))),128))])])])]),f.value?(l(),U(ye,{key:0,open:f.value,"onUpdate:open":e[2]||(e[2]=n=>f.value=n),message:L.value},null,8,["open","message"])):ne("",!0)])}}};export{Ke as default};
