import{p as L,r as k,i as H,q as R,x as q,d as r,y as z,z as G,h as x,A as K,C as h,D as J,E as Q,u as W,G as y,o as U,c as X,w as g,a as $,P as Z,l as A,j as ee,F as te,k as ne,B as ae,e as oe}from"./index-DxUjHE30.js";/* empty css              */import{f as le,p as se,P as ie,g as B,s as ue,F as re,D as me}from"./index-U0K8YNwV.js";import"./index-BcZct203.js";import{_ as ce}from"./BaseModal-CTNVJOyi.js";import{u as de}from"./useDoubleTapHint-B3pbvMAm.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as ve,a as fe}from"./index-C_xnnFKP.js";import"./use-id-R6PMLyS-.js";const[ye]=J("time-picker"),E=a=>/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/.test(a),ke=["hour","minute","second"],Te=K({},ue,{minHour:h(0),maxHour:h(23),minMinute:h(0),maxMinute:h(59),minSecond:h(0),maxSecond:h(59),minTime:{type:String,validator:E},maxTime:{type:String,validator:E},columnsType:{type:Array,default:()=>["hour","minute"]}});var be=L({name:ye,props:Te,emits:["confirm","cancel","change","update:modelValue"],setup(a,{emit:T,slots:S}){const s=k(a.modelValue),_=k(),C=t=>{const i=t.split(":");return ke.map((v,f)=>a.columnsType.includes(v)?i[f]:"00")},Y=()=>{var t;return(t=_.value)==null?void 0:t.confirm()},w=()=>s.value,D=x(()=>{let{minHour:t,maxHour:i,minMinute:v,maxMinute:f,minSecond:P,maxSecond:M}=a;if(a.minTime||a.maxTime){const c={hour:0,minute:0,second:0};a.columnsType.forEach((n,e)=>{var l;c[n]=(l=s.value[e])!=null?l:0});const{hour:u,minute:d}=c;if(a.minTime){const[n,e,l]=C(a.minTime);t=n,v=+u<=+t?e:"00",P=+u<=+t&&+d<=+v?l:"00"}if(a.maxTime){const[n,e,l]=C(a.maxTime);i=n,f=+u>=+i?e:"59",M=+u>=+i&&+d>=+f?l:"59"}}return a.columnsType.map(c=>{const{filter:u,formatter:d}=a;switch(c){case"hour":return B(+t,+i,c,d,u,s.value);case"minute":return B(+v,+f,c,d,u,s.value);case"second":return B(+P,+M,c,d,u,s.value);default:return[]}})});H(s,t=>{R(t,a.modelValue)||T("update:modelValue",t)}),H(()=>a.modelValue,t=>{t=le(t,D.value),R(t,s.value)||(s.value=t)},{immediate:!0});const m=(...t)=>T("change",...t),p=(...t)=>T("cancel",...t),b=(...t)=>T("confirm",...t);return q({confirm:Y,getSelectedTime:w}),()=>r(ie,z({ref:_,modelValue:s.value,"onUpdate:modelValue":t=>s.value=t,columns:D.value,onChange:m,onCancel:p,onConfirm:b},G(a,se)),S)}});const he=Q(be),_e={class:"retro-punch-type-section"},ge={__name:"RetroPunchModal",props:{open:Boolean},emits:["update:open"],setup(a,{emit:T}){const S=a,s=T,_=x({get:()=>S.open,set:n=>s("update:open",n)}),{addRecordAt:C}=W();de({messages:["补上瘾啦？","再补要收小费啦～","手下留情嘛～"]});const Y=[{type:"toilet",label:"如厕"},{type:"meal",label:"饭否"},{type:"fitness",label:"健身"},{type:"other",label:"其他"}],w=new Date(y().subtract(1,"year").valueOf()),D=new Date(y().valueOf()),m=k(""),p=k("12:00"),b=k("toilet"),t=k(!1),i=k(!1),v=x(()=>m.value?y(m.value).format("YYYY年M月D日"):""),f=x(()=>{if(!m.value)return[];const n=y(m.value);return[String(n.year()),String(n.month()+1),String(n.date())]}),P=x(()=>{const[n,e]=(p.value||"12:00").split(":").map(Number);return[String(n||0),String(e||0)]});function M({selectedValues:n}={}){const e=n||[];if(e.length>=3){const[l,N,V]=e.map(Number);m.value=y().year(l).month(N-1).date(V).format("YYYY-MM-DD")}t.value=!1}function c({selectedValues:n}={}){const e=n||[];e.length>=2&&(p.value=`${String(e[0]).padStart(2,"0")}:${String(e[1]).padStart(2,"0")}`),i.value=!1}function u(){m.value=y().subtract(1,"day").format("YYYY-MM-DD"),p.value="12:00",b.value="toilet"}H(()=>S.open,n=>{n&&u()},{immediate:!0});function d(){const[n,e]=(p.value||"12:00").split(":").map(Number),l=y(m.value).hour(n||0).minute(e||0).second(0).millisecond(0);l.isValid()&&(C(l,b.value),s("update:open",!1))}return(n,e)=>{const l=re,N=me,V=Z,F=he,I=fe,O=ve,j=ae;return U(),X(ce,{open:_.value,"onUpdate:open":e[7]||(e[7]=o=>_.value=o),title:"补一下～"},{default:g(()=>[e[10]||(e[10]=$("p",{class:"retro-punch-hint"},"选一下忘打我的那天、时间和类型呀～",-1)),r(l,{"model-value":v.value,label:"日期",readonly:"","is-link":"",placeholder:"选择日期",onClick:e[0]||(e[0]=o=>t.value=!0)},null,8,["model-value"]),r(l,{"model-value":p.value,label:"时间",readonly:"","is-link":"",placeholder:"选择时间",onClick:e[1]||(e[1]=o=>i.value=!0)},null,8,["model-value"]),r(V,{show:t.value,"onUpdate:show":e[3]||(e[3]=o=>t.value=o),position:"bottom",round:""},{default:g(()=>[r(N,{"model-value":f.value,"min-date":A(w),"max-date":A(D),title:"选择日期",onConfirm:M,onCancel:e[2]||(e[2]=o=>t.value=!1)},null,8,["model-value","min-date","max-date"])]),_:1},8,["show"]),r(V,{show:i.value,"onUpdate:show":e[5]||(e[5]=o=>i.value=o),position:"bottom",round:""},{default:g(()=>[r(F,{"model-value":P.value,title:"选择时间",onConfirm:c,onCancel:e[4]||(e[4]=o=>i.value=!1)},null,8,["model-value"])]),_:1},8,["show"]),$("div",_e,[e[8]||(e[8]=$("span",{class:"retro-punch-label"},"类型",-1)),r(O,{active:b.value,"onUpdate:active":e[6]||(e[6]=o=>b.value=o),type:"card",shrink:"",class:"retro-punch-type-tabs"},{default:g(()=>[(U(),ee(te,null,ne(Y,o=>r(I,{key:o.type,name:o.type,title:o.label},null,8,["name","title"])),64))]),_:1},8,["active"])]),r(j,{type:"primary",block:"",round:"",class:"retro-punch-submit",onClick:d},{default:g(()=>[...e[9]||(e[9]=[oe(" 补上～ ",-1)])]),_:1})]),_:1},8,["open"])}}},Ne=pe(ge,[["__scopeId","data-v-769faac8"]]);export{Ne as default};
