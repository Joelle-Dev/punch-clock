import{i as ne,o,c as q,w as N,a as t,t as i,d as K,B as Q,e as S,r as x,h as k,Z as G,E as oe,a7 as le,j as u,u as p,k as Z,F as _,l as z,n as I,G as J,aj as ie,ak as ce,H as ue}from"./index-BraOb1rX.js";/* empty css              */import{u as re}from"./useAchievements-CvMKsvxh.js";import{u as pe}from"./useDoubleTapHint-DX2GQIyy.js";import{_ as de}from"./BaseModal-C4CAPVMH.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as he,a as fe}from"./index-2lVRMbtx.js";import"./use-id-DvUx4d6e.js";function ve(g){switch(g){case"toilet":return"ç§‹ç‘¾åˆæ‹‰ç²‘ç²‘å•¦ï½ž";case"meal":return"ç§‹ç‘¾çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½ž";case"fitness":return"ç§‹ç‘¾å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½ž";default:return"ç§‹ç‘¾çœŸæ£’ï½ž"}}const ye={class:"punch-success-message"},be={__name:"PunchSuccessModal",props:{open:Boolean,message:{type:String,default:""}},emits:["update:open"],setup(g,{emit:f}){const v=g,C=f,d=k({get:()=>v.open,set:l=>C("update:open",l)}),y=x(null),j=["â™¥","âœ¨","â˜…","â˜†","â€¢","â™¥","âœ¨","â˜…"],T=["celebrate-float","celebrate-twinkle","celebrate-rise"],L=["#ff6b9d","#e84c7a","#ffd700","#ffb347","#c2185b","#f8bbd9"];function R(){if(y.value){y.value.innerHTML="";for(let l=0;l<28;l++){const n=document.createElement("span");n.className="celebrate-item "+T[l%T.length],n.textContent=j[l%j.length],n.style.left=Math.random()*80+10+"%",n.style.top=Math.random()*80+10+"%",n.style.animationDelay=Math.random()*.8+"s",n.style.color=L[l%L.length],n.style.fontSize=12+Math.random()*12+"px",y.value.appendChild(n)}}}function A(){G(()=>{requestAnimationFrame(()=>{G(()=>{R(),setTimeout(R,80)})})})}function $(){C("update:open",!1)}return ne(()=>v.open,l=>{l&&A()},{immediate:!0}),(l,n)=>{const r=Q;return o(),q(de,{open:d.value,"onUpdate:open":n[0]||(n[0]=m=>d.value=m),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:N(()=>[t("div",{ref_key:"celebrationRef",ref:y,class:"punch-success-celebration","aria-hidden":"true"},null,512),t("div",ye,i(g.message),1),K(r,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:$},{default:N(()=>[...n[1]||(n[1]=[S("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},_e=me(be,[["__scopeId","data-v-4d06afb7"]]),ke={class:"tab-panel active punch-panel"},ge={class:"app-header"},Te={class:"stats-row"},we={class:"stat-card"},De={class:"stat-value"},Me={class:"stat-card"},Se={class:"stat-value"},xe={class:"stat-value"},Ce={key:0,class:"stat-achievement-hint"},je={class:"app-main"},Le={class:"type-section","aria-label":"é€‰æ‹©ç±»åž‹"},Re={class:"punch-button-inner"},Ae={class:"punch-icon","aria-hidden":"true"},$e={class:"last-punch"},Be={class:"last-punch-type"},Pe={class:"last-punch-date"},Ee={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},He={class:"heatmap-container"},Ne={class:"heatmap-grid"},Ve={key:0,class:"heatmap-cell heatmap-cell-empty"},Fe=["title"],Ze={__name:"PunchView",setup(g){var W;const{records:f,todayCount:v,streak:C,lastRecord:d,addRecord:y,getMonthHeatmap:j}=oe(),{unlockedList:T,achievements:L,checkAll:R}=re(),A=k(()=>{const s=T.value;if(!s.length)return"";const e=s[s.length-1],c=L.find(D=>D.id===e);return(c==null?void 0:c.title)??""}),$=J("openAchievementModal",()=>{}),l=J("showAchievementToast",()=>{}),r=x(["toilet","meal","fitness","other"].includes((W=d.value)==null?void 0:W.type)?d.value.type:"fitness"),m=x(!1),B=x(!1),O=x(""),{shouldSkipDueToDoubleTap:X}=pe(),P=[{type:"toilet",label:"å¦‚åŽ•",emoji:"ðŸš½",short:"åŽ•",tint:"#4caf50"},{type:"meal",label:"é¥­å¦",emoji:"ðŸš",short:"é¥­",tint:"#ff9800"},{type:"fitness",label:"å¥èº«",emoji:"ðŸ’ª",short:"èº«",tint:"#2196f3"},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0"}].map(s=>({...s,tabTitle:s.emoji+" "+s.short})),E=k(()=>P.find(s=>s.type===r.value)||P[0]);function Y(s){var e;return((e=P.find(c=>c.type===s))==null?void 0:e.label)??"å…¶ä»–"}const ee=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],w=k(()=>{if(!d.value)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const s=d.value;return{hasRecord:!0,typeLabel:Y(s.type||"other"),dateDisplay:ce(s.dateKey),timeDisplay:ie(s.timestamp)}}),te=k(()=>ue()),se=k(()=>{const s=te.value,e=s.year(),c=s.month()+1,D=j(f.value,e,c),H=s.startOf("month"),a=H.daysInMonth(),V=H.day(),F=[];for(let b=0;b<V;b++)F.push({empty:!0});for(let b=1;b<=a;b++){const U=`${e}-${String(c).padStart(2,"0")}-${String(b).padStart(2,"0")}`,h=D[U]||0;let M="heatmap-cell-0";h>=6?M="heatmap-cell-4":h>=4?M="heatmap-cell-3":h>=2?M="heatmap-cell-2":h>=1&&(M="heatmap-cell-1"),F.push({empty:!1,count:h,level:M,title:h?`${U} æ‰“æˆ‘ ${h} æ¬¡`:U})}return F});function ae(){X(r.value)||(O.value=ve(r.value),B.value=!0,y(r.value),m.value=!0,requestAnimationFrame(()=>{m.value=!1,document.body.offsetHeight,m.value=!0,setTimeout(()=>m.value=!1,450)}),setTimeout(()=>{R(f.value).forEach(e=>l(e))},0))}return le(()=>{const s=()=>{f.value=[...f.value]};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&s()}),window.addEventListener("pageshow",e=>{e.persisted&&s()})}),(s,e)=>{const c=fe,D=he,H=Q;return o(),u("div",ke,[t("header",ge,[t("div",Te,[t("div",we,[t("span",De,i(p(v)),1),e[3]||(e[3]=t("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),t("div",Me,[t("span",Se,i(p(C)),1),e[4]||(e[4]=t("span",{class:"stat-label"},"è¿žç»­",-1))]),t("div",{class:"stat-card stat-card-achievement",onClick:e[0]||(e[0]=(...a)=>p($)&&p($)(...a))},[t("span",xe,i(p(T).length),1),e[5]||(e[5]=t("span",{class:"stat-label"},"æˆå°±",-1)),A.value?(o(),u("span",Ce,i(A.value),1)):Z("",!0)])])]),t("main",je,[t("section",Le,[K(D,{active:r.value,"onUpdate:active":e[1]||(e[1]=a=>r.value=a),shrink:""},{default:N(()=>[(o(!0),u(_,null,z(p(P),a=>(o(),q(c,{key:a.type,name:a.type,title:a.tabTitle},null,8,["name","title"]))),128))]),_:1},8,["active"])]),t("section",{class:I(["punch-section",{"punch-section--first":p(v)===0}])},[K(H,{type:"primary",round:"",size:"large",class:I(["punch-button",["punch-button--"+r.value,{"punch-button-bounce":m.value},{"punch-button--first":p(v)===0}]]),"aria-label":E.value?E.value.emoji+" æ‰“æˆ‘":"æ‰“æˆ‘",onClick:ae},{default:N(()=>[t("span",Re,[t("span",Ae,i(E.value?E.value.emoji:"ðŸ‘Š"),1),e[6]||(e[6]=t("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),t("p",$e,[w.value.hasRecord?(o(),u(_,{key:0},[e[7]||(e[7]=S("ä¸Šæ¬¡æ˜¯ ",-1)),t("span",Be,i(w.value.typeLabel),1),e[8]||(e[8]=S(" ï½ž ",-1)),t("span",Pe,i(w.value.dateDisplay),1),S(" "+i(w.value.timeDisplay),1)],64)):(o(),u(_,{key:1},[S(i(w.value.text),1)],64))])],2),t("section",Ee,[e[9]||(e[9]=t("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),t("div",He,[t("div",Ne,[(o(),u(_,null,z(ee,a=>t("span",{key:a,class:"heatmap-week-label"},i(a),1)),64)),(o(!0),u(_,null,z(se.value,(a,V)=>(o(),u(_,{key:V},[a.empty?(o(),u("span",Ve)):(o(),u("span",{key:1,class:I(["heatmap-cell",a.level]),title:a.title},i(a.count||""),11,Fe))],64))),128))])])])]),B.value?(o(),q(_e,{key:0,open:B.value,"onUpdate:open":e[2]||(e[2]=a=>B.value=a),message:O.value},null,8,["open","message"])):Z("",!0)])}}};export{Ze as default};
