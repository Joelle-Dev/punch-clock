import{D as p,J,A as Y,K as ae,p as oe,L as G,M as Ce,x as de,N as Qe,O as Te,d as h,Q as re,R as le,r as B,S as ee,T as Xe,h as I,U as Oe,V as He,C as te,i as Q,q as X,W as pe,X as et,Y as Z,z as ye,y as ue,Z as ne,_ as tt,$ as nt,E as ke,a0 as at,a1 as lt,a2 as ot,a3 as it,a4 as rt,a5 as ct,a6 as st,a7 as ut,a8 as De,a9 as dt,aa as Ve,ab as ge,ac as ft,e as mt,ad as gt,ae as ht,af as vt,ag as Le,ah as Ee}from"./index-DxUjHE30.js";import{C as bt,c as yt}from"./index-BcZct203.js";import{u as xt}from"./use-id-R6PMLyS-.js";const[Ct,F,we]=p("picker"),$e=e=>e.find(n=>!n.disabled)||e[0];function Tt(e,n){const a=e[0];if(a){if(Array.isArray(a))return"multiple";if(n.children in a)return"cascade"}return"default"}function se(e,n){n=ae(n,0,e.length);for(let a=n;a<e.length;a++)if(!e[a].disabled)return a;for(let a=n-1;a>=0;a--)if(!e[a].disabled)return a;return 0}const Pe=(e,n,a)=>n!==void 0&&e.some(i=>i[a.value]===n);function xe(e,n,a){const i=e.findIndex(u=>u[a.value]===n),l=se(e,i);return e[l]}function kt(e,n,a){const i=[];let l={[n.children]:e},u=0;for(;l&&l[n.children];){const y=l[n.children],x=a.value[u];if(l=J(x)?xe(y,x,n):void 0,!l&&y.length){const s=$e(y)[n.value];l=xe(y,s,n)}u++,i.push(y)}return i}function St(e){const{transform:n}=window.getComputedStyle(e),a=n.slice(7,n.length-1).split(", ")[5];return Number(a)}function Mt(e){return Y({text:"text",value:"value",children:"children"},e)}const _e=200,Be=300,It=15,[Fe,he]=p("picker-column"),Ye=Symbol(Fe);var Ot=oe({name:Fe,props:{value:G,fields:re(Object),options:le(),readonly:Boolean,allowHtml:Boolean,optionHeight:re(Number),swipeDuration:re(G),visibleOptionNum:re(G)},emits:["change","clickOption","scrollInto"],setup(e,{emit:n,slots:a}){let i,l,u,y,x;const s=B(),C=B(),m=B(0),T=B(0),E=Xe(),N=()=>e.options.length,z=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,D=g=>{let v=se(e.options,g);const o=-v*e.optionHeight,c=()=>{v>N()-1&&(v=se(e.options,g));const b=e.options[v][e.fields.value];b!==e.value&&n("change",b)};i&&o!==m.value?x=c:c(),m.value=o},O=()=>e.readonly||!e.options.length,L=g=>{i||O()||(x=null,T.value=_e,D(g),n("clickOption",e.options[g]))},w=g=>ae(Math.round(-g/e.optionHeight),0,N()-1),K=I(()=>w(m.value)),R=(g,v)=>{const o=Math.abs(g/v);g=m.value+o/.003*(g<0?-1:1);const c=w(g);T.value=+e.swipeDuration,D(c)},r=()=>{i=!1,T.value=0,x&&(x(),x=null)},k=g=>{if(!O()){if(E.start(g),i){const v=St(C.value);m.value=Math.min(0,v-z())}T.value=0,l=m.value,u=Date.now(),y=l,x=null}},P=g=>{if(O())return;E.move(g),E.isVertical()&&(i=!0,ee(g,!0));const v=ae(l+E.deltaY.value,-(N()*e.optionHeight),e.optionHeight),o=w(v);o!==K.value&&n("scrollInto",e.options[o]),m.value=v;const c=Date.now();c-u>Be&&(u=c,y=v)},V=()=>{if(O())return;const g=m.value-y,v=Date.now()-u;if(v<Be&&Math.abs(g)>It){R(g,v);return}const c=w(m.value);T.value=_e,D(c),setTimeout(()=>{i=!1},0)},$=()=>{const g={height:`${e.optionHeight}px`};return e.options.map((v,o)=>{const c=v[e.fields.text],{disabled:b}=v,j=v[e.fields.value],U={role:"button",style:g,tabindex:b?-1:0,class:[he("item",{disabled:b,selected:j===e.value}),v.className],onClick:()=>L(o)},me={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:c};return h("li",U,[a.option?a.option(v,o):h("div",me,null)])})};return Ce(Ye),de({stopMomentum:r}),Qe(()=>{const g=i?Math.floor(-m.value/e.optionHeight):e.options.findIndex(c=>c[e.fields.value]===e.value),v=se(e.options,g),o=-v*e.optionHeight;i&&v<g&&r(),m.value=o}),Te("touchmove",P,{target:s}),()=>h("div",{ref:s,class:he(),onTouchstartPassive:k,onTouchend:V,onTouchcancel:V},[h("ul",{ref:C,style:{transform:`translate3d(0, ${m.value+z()}px, 0)`,transitionDuration:`${T.value}ms`,transitionProperty:T.value?"all":"none"},class:he("wrapper"),onTransitionend:r},[$()])])}});const[Dt]=p("picker-toolbar"),fe={title:String,cancelButtonText:String,confirmButtonText:String},Vt=["cancel","confirm","title","toolbar"],Et=Object.keys(fe);var wt=oe({name:Dt,props:fe,emits:["confirm","cancel"],setup(e,{emit:n,slots:a}){const i=()=>{if(a.title)return a.title();if(e.title)return h("div",{class:[F("title"),"van-ellipsis"]},[e.title])},l=()=>n("cancel"),u=()=>n("confirm"),y=()=>{var s;const C=(s=e.cancelButtonText)!=null?s:we("cancel");if(!(!a.cancel&&!C))return h("button",{type:"button",class:[F("cancel"),Oe],onClick:l},[a.cancel?a.cancel():C])},x=()=>{var s;const C=(s=e.confirmButtonText)!=null?s:we("confirm");if(!(!a.confirm&&!C))return h("button",{type:"button",class:[F("confirm"),Oe],onClick:u},[a.confirm?a.confirm():C])};return()=>h("div",{class:F("toolbar")},[a.toolbar?a.toolbar():[y(),i(),x()]])}});const[Pt]=p("picker-group"),_t=Symbol(Pt);Y({tabs:le(),activeTab:te(0),nextStepText:String,showToolbar:He},fe);const Se=Y({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:te(44),showToolbar:He,swipeDuration:te(1e3),visibleOptionNum:te(6)},fe),Bt=Y({},Se,{columns:le(),modelValue:le(),toolbarPosition:ne("top"),columnsFieldNames:Object});var At=oe({name:Ct,props:Bt,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:n,slots:a}){const i=B(),l=B(e.modelValue.slice(0)),{parent:u}=Ce(_t),{children:y,linkChildren:x}=et(Ye);x();const s=I(()=>Mt(e.columnsFieldNames)),C=I(()=>tt(e.optionHeight)),m=I(()=>Tt(e.columns,s.value)),T=I(()=>{const{columns:o}=e;switch(m.value){case"multiple":return o;case"cascade":return kt(o,s.value,l);default:return[o]}}),E=I(()=>T.value.some(o=>o.length)),N=I(()=>T.value.map((o,c)=>xe(o,l.value[c],s.value))),z=I(()=>T.value.map((o,c)=>o.findIndex(b=>b[s.value.value]===l.value[c]))),D=(o,c)=>{if(l.value[o]!==c){const b=l.value.slice(0);b[o]=c,l.value=b}},O=()=>({selectedValues:l.value.slice(0),selectedOptions:N.value,selectedIndexes:z.value}),L=(o,c)=>{D(c,o),m.value==="cascade"&&l.value.forEach((b,j)=>{const U=T.value[j];Pe(U,b,s.value)||D(j,U.length?U[0][s.value.value]:void 0)}),Z(()=>{n("change",Y({columnIndex:c},O()))})},w=(o,c)=>{const b={columnIndex:c,currentOption:o};n("clickOption",Y(O(),b)),n("scrollInto",b)},K=()=>{y.forEach(c=>c.stopMomentum());const o=O();return Z(()=>{const c=O();n("confirm",c)}),o},R=()=>n("cancel",O()),r=()=>T.value.map((o,c)=>h(Ot,{value:l.value[c],fields:s.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:C.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:b=>L(b,c),onClickOption:b=>w(b,c),onScrollInto:b=>{n("scrollInto",{currentOption:b,columnIndex:c})}},{option:a.option})),k=o=>{if(E.value){const c={height:`${C.value}px`},b={backgroundSize:`100% ${(o-C.value)/2}px`};return[h("div",{class:F("mask"),style:b},null),h("div",{class:[nt,F("frame")],style:c},null)]}},P=()=>{const o=C.value*+e.visibleOptionNum,c={height:`${o}px`};return!e.loading&&!E.value&&a.empty?a.empty():h("div",{ref:i,class:F("columns"),style:c},[r(),k(o)])},V=()=>{if(e.showToolbar&&!u)return h(wt,ue(ye(e,Et),{onConfirm:K,onCancel:R}),ye(a,Vt))},$=o=>{o.forEach((c,b)=>{c.length&&!Pe(c,l.value[b],s.value)&&D(b,$e(c)[s.value.value])})};Q(T,o=>$(o),{immediate:!0});let g;return Q(()=>e.modelValue,o=>{!X(o,l.value)&&!X(o,g)&&(l.value=o.slice(0),g=o.slice(0)),e.modelValue.length===0&&$(T.value)},{deep:!0}),Q(l,o=>{X(o,e.modelValue)||(g=o.slice(0),n("update:modelValue",g))},{immediate:!0}),Te("touchmove",ee,{target:i}),de({confirm:K,getSelectedOptions:()=>N.value}),()=>{var o,c;return h("div",{class:F()},[e.toolbarPosition==="top"?V():null,e.loading?h(pe,{class:F("loading")},null):null,(o=a["columns-top"])==null?void 0:o.call(a),P(),(c=a["columns-bottom"])==null?void 0:c.call(a),e.toolbarPosition==="bottom"?V():null])}}});const Nt=ke(At);function ze(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function Rt(e,n){if(ze(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function Ht(e,n){return new Promise(a=>{const i=n.validator(e,n);if(rt(i)){i.then(a);return}a(i)})}function Ae(e,n){const{message:a}=n;return it(a)?a(e,n):a||""}function Lt({target:e}){e.composing=!0}function Ne({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function $t(e,n){const a=at();e.style.height="auto";let i=e.scrollHeight;if(lt(n)){const{maxHeight:l,minHeight:u}=n;l!==void 0&&(i=Math.min(i,l)),u!==void 0&&(i=Math.max(i,u))}i&&(e.style.height=`${i}px`,ot(a))}function Ft(e,n){return e==="number"&&(e="text",n??(n="decimal")),e==="digit"&&(e="tel",n??(n="numeric")),{type:e,inputmode:n}}function ce(e){return[...e].length}function ve(e,n){return[...e].slice(0,n).join("")}const[Yt,_]=p("field"),zt={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:G,max:Number,min:Number,formatter:Function,clearIcon:ne("clear"),modelValue:te(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:ne("focus"),formatTrigger:ne("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},Kt=Y({},yt,zt,{rows:G,type:ne("text"),rules:Array,autosize:[Boolean,Object],labelWidth:G,labelClass:ft,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var jt=oe({name:Yt,props:Kt,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:a}){const i=xt(),l=ut({status:"unvalidated",focused:!1,validateMessage:""}),u=B(),y=B(),x=B(),{parent:s}=Ce(ct),C=()=>{var t;return String((t=e.modelValue)!=null?t:"")},m=t=>{if(J(e[t]))return e[t];if(s&&J(s.props[t]))return s.props[t]},T=I(()=>{const t=m("readonly");if(e.clearable&&!t){const d=C()!=="",f=e.clearTrigger==="always"||e.clearTrigger==="focus"&&l.focused;return d&&f}return!1}),E=I(()=>x.value&&a.input?x.value():e.modelValue),N=I(()=>{var t;const d=m("required");return d==="auto"?(t=e.rules)==null?void 0:t.some(f=>f.required):d}),z=t=>t.reduce((d,f)=>d.then(()=>{if(l.status==="failed")return;let{value:S}=E;if(f.formatter&&(S=f.formatter(S,f)),!Rt(S,f)){l.status="failed",l.validateMessage=Ae(S,f);return}if(f.validator)return ze(S)&&f.validateEmpty===!1?void 0:Ht(S,f).then(M=>{M&&typeof M=="string"?(l.status="failed",l.validateMessage=M):M===!1&&(l.status="failed",l.validateMessage=Ae(S,f))})}),Promise.resolve()),D=()=>{l.status="unvalidated",l.validateMessage=""},O=()=>n("endValidate",{status:l.status,message:l.validateMessage}),L=(t=e.rules)=>new Promise(d=>{D(),t?(n("startValidate"),z(t).then(()=>{l.status==="failed"?(d({name:e.name,message:l.validateMessage}),O()):(l.status="passed",d(),O())})):d()}),w=t=>{if(s&&e.rules){const{validateTrigger:d}=s.props,f=De(d).includes(t),S=e.rules.filter(M=>M.trigger?De(M.trigger).includes(t):f);S.length&&L(S)}},K=t=>{var d;const{maxlength:f}=e;if(J(f)&&ce(t)>+f){const S=C();if(S&&ce(S)===+f)return S;const M=(d=u.value)==null?void 0:d.selectionEnd;if(l.focused&&M){const W=[...t],q=W.length-+f;return W.splice(M-q,q),W.join("")}return ve(t,+f)}return t},R=(t,d="onChange")=>{var f,S;const M=t;t=K(t);const W=M.length-t.length;if(e.type==="number"||e.type==="digit"){const H=e.type==="number";if(t=dt(t,H,H),d==="onBlur"&&t!==""&&(e.min!==void 0||e.max!==void 0)){const A=ae(+t,(f=e.min)!=null?f:-1/0,(S=e.max)!=null?S:1/0);+t!==A&&(t=A.toString())}}let q=0;if(e.formatter&&d===e.formatTrigger){const{formatter:H,maxlength:A}=e;if(t=H(t),J(A)&&ce(t)>+A&&(t=ve(t,+A)),u.value&&l.focused){const{selectionEnd:ie}=u.value,Ie=ve(M,ie);q=H(Ie).length-Ie.length}}if(u.value&&u.value.value!==t)if(l.focused){let{selectionStart:H,selectionEnd:A}=u.value;if(u.value.value=t,J(H)&&J(A)){const ie=t.length;W?(H-=W,A-=W):q&&(H+=q,A+=q),u.value.setSelectionRange(Math.min(H,ie),Math.min(A,ie))}}else u.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},r=t=>{t.target.composing||R(t.target.value)},k=()=>{var t;return(t=u.value)==null?void 0:t.blur()},P=()=>{var t;return(t=u.value)==null?void 0:t.focus()},V=()=>{const t=u.value;e.type==="textarea"&&e.autosize&&t&&$t(t,e.autosize)},$=t=>{l.focused=!0,n("focus",t),Z(V),m("readonly")&&k()},g=t=>{l.focused=!1,R(C(),"onBlur"),n("blur",t),!m("readonly")&&(w("onBlur"),Z(V),gt())},v=t=>n("clickInput",t),o=t=>n("clickLeftIcon",t),c=t=>n("clickRightIcon",t),b=t=>{ee(t),n("update:modelValue",""),n("clear",t)},j=I(()=>{if(typeof e.error=="boolean")return e.error;if(s&&s.props.showError&&l.status==="failed")return!0}),U=I(()=>{const t=m("labelWidth"),d=m("labelAlign");if(t&&d!=="top")return{width:Ve(t)}}),me=t=>{t.keyCode===13&&(!(s&&s.props.submitOnEnter)&&e.type!=="textarea"&&ee(t),e.type==="search"&&k()),n("keypress",t)},Me=()=>e.id||`${i}-input`,Ke=()=>l.status,je=()=>{const t=_("control",[m("inputAlign"),{error:j.value,custom:!!a.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(a.input)return h("div",{class:t,onClick:v},[a.input()]);const d={id:Me(),ref:u,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:m("disabled"),readonly:m("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${i}-label`:void 0,"data-allow-mismatch":"attribute",onBlur:g,onFocus:$,onInput:r,onClick:v,onChange:Ne,onKeypress:me,onCompositionend:Ne,onCompositionstart:Lt};return e.type==="textarea"?h("textarea",ue(d,{inputmode:e.inputmode}),null):h("input",ue(Ft(e.type,e.inputmode),d),null)},Ue=()=>{const t=a["left-icon"];if(e.leftIcon||t)return h("div",{class:_("left-icon"),onClick:o},[t?t():h(ge,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},We=()=>{const t=a["right-icon"];if(e.rightIcon||t)return h("div",{class:_("right-icon"),onClick:c},[t?t():h(ge,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},qe=()=>{if(e.showWordLimit&&e.maxlength){const t=ce(C());return h("div",{class:_("word-limit")},[h("span",{class:_("word-num")},[t]),mt("/"),e.maxlength])}},Je=()=>{if(s&&s.props.showErrorMessage===!1)return;const t=e.errorMessage||l.validateMessage;if(t){const d=a["error-message"],f=m("errorMessageAlign");return h("div",{class:_("error-message",f)},[d?d({message:t}):t])}},Ze=()=>{const t=m("labelWidth"),d=m("labelAlign"),f=m("colon")?":":"";if(a.label)return[a.label(),f];if(e.label)return h("label",{id:`${i}-label`,for:a.input?void 0:Me(),"data-allow-mismatch":"attribute",onClick:S=>{ee(S),P()},style:d==="top"&&t?{width:Ve(t)}:void 0},[e.label+f])},Ge=()=>[h("div",{class:_("body")},[je(),T.value&&h(ge,{ref:y,name:e.clearIcon,class:_("clear")},null),We(),a.button&&h("div",{class:_("button")},[a.button()])]),qe(),Je()];return de({blur:k,focus:P,validate:L,formValue:E,resetValidation:D,getValidationStatus:Ke}),ht(vt,{customValue:x,resetValidation:D,validateWithTrigger:w}),Q(()=>e.modelValue,()=>{R(C()),D(),w("onChange"),Z(V)}),st(()=>{R(C(),e.formatTrigger),Z(V)}),Te("touchstart",b,{target:I(()=>{var t;return(t=y.value)==null?void 0:t.$el})}),()=>{const t=m("disabled"),d=m("labelAlign"),f=Ue(),S=()=>{const M=Ze();return d==="top"?[f,M].filter(Boolean):M||[]};return h(bt,{size:e.size,class:_({error:j.value,disabled:t,[`label-${d}`]:d}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:U.value,valueClass:_("value"),titleClass:[_("label",[d,{required:N.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:f&&d!=="top"?()=>f:null,title:S,value:Ge,extra:a.extra})}}});const nn=ke(jt),Ut=Y({},Se,{modelValue:le(),filter:Function,formatter:{type:Function,default:(e,n)=>n}}),Wt=Object.keys(Se);function qt(e,n){if(e<0)return[];const a=Array(e);let i=-1;for(;++i<e;)a[i]=n(i);return a}const Jt=(e,n)=>32-new Date(e,n-1,32).getDate(),be=(e,n,a,i,l,u)=>{const y=qt(n-e+1,x=>{const s=Le(e+x);return i(a,{text:s,value:s})});return l?l(a,y,u):y},Zt=(e,n)=>e.map((a,i)=>{const l=n[i];if(l.length){const u=+l[0].value,y=+l[l.length-1].value;return Le(ae(+a,u,y))}return a}),Re=new Date().getFullYear(),[Gt]=p("date-picker"),Qt=Y({},Ut,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(Re-10,0,1),validator:Ee},maxDate:{type:Date,default:()=>new Date(Re+10,11,31),validator:Ee}});var Xt=oe({name:Gt,props:Qt,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:n,slots:a}){const i=B(e.modelValue),l=B(!1),u=B(),y=I(()=>l.value?e.modelValue:i.value),x=r=>r===e.minDate.getFullYear(),s=r=>r===e.maxDate.getFullYear(),C=r=>r===e.minDate.getMonth()+1,m=r=>r===e.maxDate.getMonth()+1,T=r=>{const{minDate:k,columnsType:P}=e,V=P.indexOf(r),$=y.value[V];if($)return+$;switch(r){case"year":return k.getFullYear();case"month":return k.getMonth()+1;case"day":return k.getDate()}},E=()=>{const r=e.minDate.getFullYear(),k=e.maxDate.getFullYear();return be(r,k,"year",e.formatter,e.filter,y.value)},N=()=>{const r=T("year"),k=x(r)?e.minDate.getMonth()+1:1,P=s(r)?e.maxDate.getMonth()+1:12;return be(k,P,"month",e.formatter,e.filter,y.value)},z=()=>{const r=T("year"),k=T("month"),P=x(r)&&C(k)?e.minDate.getDate():1,V=s(r)&&m(k)?e.maxDate.getDate():Jt(r,k);return be(P,V,"day",e.formatter,e.filter,y.value)},D=()=>{var r;return(r=u.value)==null?void 0:r.confirm()},O=()=>i.value,L=I(()=>e.columnsType.map(r=>{switch(r){case"year":return E();case"month":return N();case"day":return z();default:return[]}}));Q(i,r=>{X(r,e.modelValue)||n("update:modelValue",r)}),Q(()=>e.modelValue,(r,k)=>{l.value=X(k,i.value),r=Zt(r,L.value),X(r,i.value)||(i.value=r),l.value=!1},{immediate:!0});const w=(...r)=>n("change",...r),K=(...r)=>n("cancel",...r),R=(...r)=>n("confirm",...r);return de({confirm:D,getSelectedDate:O}),()=>h(Nt,ue({ref:u,modelValue:i.value,"onUpdate:modelValue":r=>i.value=r,columns:L.value,onChange:w,onCancel:K,onConfirm:R},ye(e,Wt)),a)}});const an=ke(Xt);export{an as D,nn as F,Nt as P,Zt as f,be as g,Wt as p,Ut as s};
