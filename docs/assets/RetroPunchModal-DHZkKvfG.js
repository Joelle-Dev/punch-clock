import{p as G,r as b,i as E,q as U,x as K,d as m,y as J,z as Q,h as C,A as W,C as g,D as X,E as Z,G as ee,u as te,H as ne,I as T,o as F,c as ae,w as S,a as B,P as oe,m as I,j as le,F as se,l as ie,B as ue,e as re}from"./index-C_wwRE52.js";/* empty css              */import{f as me,p as ce,P as de,g as R,s as pe,D as ve}from"./index-Du1LNVsf.js";import{F as fe}from"./index-Bddluq6K.js";import{_ as he}from"./BaseModal-LeGiyXv6.js";import{u as ye}from"./useDoubleTapHint-D2msMX91.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as be,a as ke}from"./index-CZt-esB8.js";import"./use-id-x2m0WU3S.js";const[_e]=X("time-picker"),j=n=>/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/.test(n),ge=["hour","minute","second"],xe=W({},pe,{minHour:g(0),maxHour:g(23),minMinute:g(0),maxMinute:g(59),minSecond:g(0),maxSecond:g(59),minTime:{type:String,validator:j},maxTime:{type:String,validator:j},columnsType:{type:Array,default:()=>["hour","minute"]}});var Se=G({name:_e,props:xe,emits:["confirm","cancel","change","update:modelValue"],setup(n,{emit:k,slots:D}){const l=b(n.modelValue),x=b(),P=e=>{const s=e.split(":");return ge.map((u,i)=>n.columnsType.includes(u)?s[i]:"00")},Y=()=>{var e;return(e=x.value)==null?void 0:e.confirm()},A=()=>l.value,w=C(()=>{let{minHour:e,maxHour:s,minMinute:u,maxMinute:i,minSecond:d,maxSecond:M}=n;if(n.minTime||n.maxTime){const c={hour:0,minute:0,second:0};n.columnsType.forEach((f,h)=>{var v;c[f]=(v=l.value[h])!=null?v:0});const{hour:r,minute:p}=c;if(n.minTime){const[f,h,v]=P(n.minTime);e=f,u=+r<=+e?h:"00",d=+r<=+e&&+p<=+u?v:"00"}if(n.maxTime){const[f,h,v]=P(n.maxTime);s=f,i=+r>=+s?h:"59",M=+r>=+s&&+p>=+i?v:"59"}}return n.columnsType.map(c=>{const{filter:r,formatter:p}=n;switch(c){case"hour":return R(+e,+s,c,p,r,l.value);case"minute":return R(+u,+i,c,p,r,l.value);case"second":return R(+d,+M,c,p,r,l.value);default:return[]}})});E(l,e=>{U(e,n.modelValue)||k("update:modelValue",e)}),E(()=>n.modelValue,e=>{e=me(e,w.value),U(e,l.value)||(l.value=e)},{immediate:!0});const H=(...e)=>k("change",...e),N=(...e)=>k("cancel",...e),$=(...e)=>k("confirm",...e);return K({confirm:Y,getSelectedTime:A}),()=>m(de,J({ref:x,modelValue:l.value,"onUpdate:modelValue":e=>l.value=e,columns:w.value,onChange:H,onCancel:N,onConfirm:$},Q(n,ce)),D)}});const Ce=Z(Se),De={class:"retro-punch-type-section"},Pe={__name:"RetroPunchModal",props:{open:Boolean},emits:["update:open"],setup(n,{emit:k}){const D=n,l=k,x=C({get:()=>D.open,set:a=>l("update:open",a)}),{records:P,addRecordAt:Y}=ee(),{checkAll:A}=te(),w=ne("showAchievementToast",()=>{});ye({messages:["补上瘾啦？","再补要收小费啦～","手下留情嘛～"]});const H=[{type:"toilet",label:"如厕"},{type:"meal",label:"饭否"},{type:"fitness",label:"健身"},{type:"other",label:"其他"}],N=new Date(T().subtract(1,"year").valueOf()),$=new Date(T().valueOf()),e=b(""),s=b("12:00"),u=b("toilet"),i=b(!1),d=b(!1),M=C(()=>e.value?T(e.value).format("YYYY年M月D日"):""),c=C(()=>{if(!e.value)return[];const a=T(e.value);return[String(a.year()),String(a.month()+1),String(a.date())]}),r=C(()=>{const[a,t]=(s.value||"12:00").split(":").map(Number);return[String(a||0),String(t||0)]});function p({selectedValues:a}={}){const t=a||[];if(t.length>=3){const[y,V,_]=t.map(Number);e.value=T().year(y).month(V-1).date(_).format("YYYY-MM-DD")}i.value=!1}function f({selectedValues:a}={}){const t=a||[];t.length>=2&&(s.value=`${String(t[0]).padStart(2,"0")}:${String(t[1]).padStart(2,"0")}`),d.value=!1}function h(){e.value=T().subtract(1,"day").format("YYYY-MM-DD"),s.value="12:00",u.value="toilet"}E(()=>D.open,a=>{a&&h()},{immediate:!0});function v(){const[a,t]=(s.value||"12:00").split(":").map(Number),y=T(e.value).hour(a||0).minute(t||0).second(0).millisecond(0);y.isValid()&&(Y(y,u.value),l("update:open",!1),setTimeout(()=>{A(P.value).forEach(_=>w(_))},0))}return(a,t)=>{const y=fe,V=ve,_=oe,O=Ce,L=ke,q=be,z=ue;return F(),ae(he,{open:x.value,"onUpdate:open":t[7]||(t[7]=o=>x.value=o),title:"补一下～"},{default:S(()=>[t[10]||(t[10]=B("p",{class:"retro-punch-hint"},"选一下忘打我的那天、时间和类型呀～",-1)),m(y,{"model-value":M.value,label:"日期",readonly:"","is-link":"",placeholder:"选择日期",onClick:t[0]||(t[0]=o=>i.value=!0)},null,8,["model-value"]),m(y,{"model-value":s.value,label:"时间",readonly:"","is-link":"",placeholder:"选择时间",onClick:t[1]||(t[1]=o=>d.value=!0)},null,8,["model-value"]),m(_,{show:i.value,"onUpdate:show":t[3]||(t[3]=o=>i.value=o),position:"bottom",round:""},{default:S(()=>[m(V,{"model-value":c.value,"min-date":I(N),"max-date":I($),title:"选择日期",onConfirm:p,onCancel:t[2]||(t[2]=o=>i.value=!1)},null,8,["model-value","min-date","max-date"])]),_:1},8,["show"]),m(_,{show:d.value,"onUpdate:show":t[5]||(t[5]=o=>d.value=o),position:"bottom",round:""},{default:S(()=>[m(O,{"model-value":r.value,title:"选择时间",onConfirm:f,onCancel:t[4]||(t[4]=o=>d.value=!1)},null,8,["model-value"])]),_:1},8,["show"]),B("div",De,[t[8]||(t[8]=B("span",{class:"retro-punch-label"},"类型",-1)),m(q,{active:u.value,"onUpdate:active":t[6]||(t[6]=o=>u.value=o),type:"card",shrink:"",class:"retro-punch-type-tabs"},{default:S(()=>[(F(),le(se,null,ie(H,o=>m(L,{key:o.type,name:o.type,title:o.label},null,8,["name","title"])),64))]),_:1},8,["active"])]),m(z,{type:"primary",block:"",round:"",class:"retro-punch-submit",onClick:v},{default:S(()=>[...t[9]||(t[9]=[re(" 补上～ ",-1)])]),_:1})]),_:1},8,["open"])}}},Re=Te(Pe,[["__scopeId","data-v-b34d0e9e"]]);export{Re as default};
