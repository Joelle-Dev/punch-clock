import{L as se,o as l,c as z,w as E,a as t,t as c,d as H,B as Q,e as M,r as b,h as S,P as G,ac as ae,a0 as ne,i,u,F as _,j as F,n as O,af as oe,ag as J,ah as le,ai as ce,aj as ie,ad as re}from"./index-B9lxshWK.js";import{T as ue,a as pe}from"./index-BQLXNSNW.js";import{u as de}from"./useAchievements-DGOqdtuC.js";import{_ as me}from"./BaseModal-CAkZ7Lid.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-id-DYUp4Y_S.js";function fe(g){switch(g){case"toilet":return"ç§‹ç‘¾åˆæ‹‰ç²‘ç²‘å•¦ï½";case"meal":return"ç§‹ç‘¾çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½";case"fitness":return"ç§‹ç‘¾å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½";default:return"ç§‹ç‘¾çœŸæ£’ï½"}}const ve={class:"punch-success-message"},ye={__name:"PunchSuccessModal",props:{open:Boolean,message:{type:String,default:""}},emits:["update:open"],setup(g,{emit:m}){const h=g,D=m,p=S({get:()=>h.open,set:o=>D("update:open",o)}),f=b(null),x=["â™¥","âœ¨","â˜…","â˜†","â€¢","â™¥","âœ¨","â˜…"],C=["celebrate-float","celebrate-twinkle","celebrate-rise"],L=["#ff6b9d","#e84c7a","#ffd700","#ffb347","#c2185b","#f8bbd9"];function T(){if(f.value){f.value.innerHTML="";for(let o=0;o<28;o++){const a=document.createElement("span");a.className="celebrate-item "+C[o%C.length],a.textContent=x[o%x.length],a.style.left=Math.random()*80+10+"%",a.style.top=Math.random()*80+10+"%",a.style.animationDelay=Math.random()*.8+"s",a.style.color=L[o%L.length],a.style.fontSize=12+Math.random()*12+"px",f.value.appendChild(a)}}}function R(){G(()=>{requestAnimationFrame(()=>{G(()=>{T(),setTimeout(T,80)})})})}function q(){D("update:open",!1)}return se(()=>h.open,o=>{o&&R()},{immediate:!0}),(o,a)=>{const v=Q;return l(),z(me,{open:p.value,"onUpdate:open":a[0]||(a[0]=j=>p.value=j),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:E(()=>[t("div",{ref_key:"celebrationRef",ref:f,class:"punch-success-celebration","aria-hidden":"true"},null,512),t("div",ve,c(g.message),1),H(v,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:q},{default:E(()=>[...a[1]||(a[1]=[M("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},_e=he(ye,[["__scopeId","data-v-4d06afb7"]]),be={class:"tab-panel active punch-panel"},ge={class:"app-header"},Te={class:"stats-row"},ke={class:"stat-card"},we={class:"stat-value"},Me={class:"stat-card"},Se={class:"stat-value"},De={class:"stat-value"},xe={class:"app-main"},Ce={class:"type-section","aria-label":"é€‰æ‹©ç±»å‹"},Le={class:"punch-button-inner"},je={class:"punch-icon","aria-hidden":"true"},Ae={class:"last-punch"},Pe={class:"last-punch-type"},Be={class:"last-punch-date"},Ee={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},Re={class:"heatmap-container"},$e={class:"heatmap-grid"},Ne={key:0,class:"heatmap-cell heatmap-cell-empty"},Ue=["title"],Ve=5*60*1e3,Ke={__name:"PunchView",setup(g){var W;const{records:m,todayCount:h,streak:D,lastRecord:p,addRecord:f,getMonthHeatmap:x}=ae(),{unlockedList:C,checkAll:L}=de(),T=J("openAchievementModal",()=>{}),R=J("showAchievementToast",()=>{}),o=b(["toilet","meal","fitness","other"].includes((W=p.value)==null?void 0:W.type)?p.value.type:"fitness"),a=b(!1),v=b(!1),j=b(""),I=b(0),A=[{type:"toilet",label:"å¦‚å•",emoji:"ğŸš½",short:"å•",tint:"#4caf50"},{type:"meal",label:"é¥­å¦",emoji:"ğŸš",short:"é¥­",tint:"#ff9800"},{type:"fitness",label:"å¥èº«",emoji:"ğŸ’ª",short:"èº«",tint:"#2196f3"},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0"}].map(s=>({...s,tabTitle:s.emoji+" "+s.short})),P=S(()=>A.find(s=>s.type===o.value)||A[0]);function X(s){var e;return((e=A.find(r=>r.type===s))==null?void 0:e.label)??"å…¶ä»–"}const Y=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],k=S(()=>{if(!p.value)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const s=p.value;return{hasRecord:!0,typeLabel:X(s.type||"other"),dateDisplay:ie(s.dateKey),timeDisplay:ce(s.timestamp)}}),Z=S(()=>re()),ee=S(()=>{const s=Z.value,e=s.year(),r=s.month()+1,$=x(m.value,e,r),B=s.startOf("month"),n=B.daysInMonth(),N=B.day(),U=[];for(let y=0;y<N;y++)U.push({empty:!0});for(let y=1;y<=n;y++){const V=`${e}-${String(r).padStart(2,"0")}-${String(y).padStart(2,"0")}`,d=$[V]||0;let w="heatmap-cell-0";d>=6?w="heatmap-cell-4":d>=4?w="heatmap-cell-3":d>=2?w="heatmap-cell-2":d>=1&&(w="heatmap-cell-1"),U.push({empty:!1,count:d,level:w,title:d?`${V} æ‰“æˆ‘ ${d} æ¬¡`:V})}return U}),K=["æ‰“ä¸Šç˜¾äº†ï¼Ÿ","å†æ‰“è¦æ”¶è´¹äº†ï½","æ‰‹ä¸‹ç•™æƒ…ï½"];function te(){const s=Date.now();if(s-I.value<Ve){le(K[Math.floor(Math.random()*K.length)]);return}I.value=s,j.value=fe(o.value),v.value=!0,f(o.value),a.value=!0,requestAnimationFrame(()=>{a.value=!1,document.body.offsetHeight,a.value=!0,setTimeout(()=>a.value=!1,450)}),setTimeout(()=>{L(m.value).forEach(r=>R(r))},0)}return ne(()=>{const s=()=>{m.value=[...m.value]};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&s()}),window.addEventListener("pageshow",e=>{e.persisted&&s()})}),(s,e)=>{const r=pe,$=ue,B=Q;return l(),i("div",be,[t("header",ge,[t("div",Te,[t("div",ke,[t("span",we,c(u(h)),1),e[3]||(e[3]=t("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),t("div",Me,[t("span",Se,c(u(D)),1),e[4]||(e[4]=t("span",{class:"stat-label"},"è¿ç»­",-1))]),t("div",{class:"stat-card stat-card-achievement",onClick:e[0]||(e[0]=(...n)=>u(T)&&u(T)(...n))},[t("span",De,c(u(C).length),1),e[5]||(e[5]=t("span",{class:"stat-label"},"æˆå°±",-1))])])]),t("main",xe,[t("section",Ce,[H($,{active:o.value,"onUpdate:active":e[1]||(e[1]=n=>o.value=n),shrink:""},{default:E(()=>[(l(!0),i(_,null,F(u(A),n=>(l(),z(r,{key:n.type,name:n.type,title:n.tabTitle},null,8,["name","title"]))),128))]),_:1},8,["active"])]),t("section",{class:O(["punch-section",{"punch-section--first":u(h)===0}])},[H(B,{type:"primary",round:"",size:"large",class:O(["punch-button",["punch-button--"+o.value,{"punch-button-bounce":a.value},{"punch-button--first":u(h)===0}]]),"aria-label":P.value?P.value.emoji+" æ‰“æˆ‘":"æ‰“æˆ‘",onClick:te},{default:E(()=>[t("span",Le,[t("span",je,c(P.value?P.value.emoji:"ğŸ‘Š"),1),e[6]||(e[6]=t("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),t("p",Ae,[k.value.hasRecord?(l(),i(_,{key:0},[e[7]||(e[7]=M("ä¸Šæ¬¡æ˜¯ ",-1)),t("span",Pe,c(k.value.typeLabel),1),e[8]||(e[8]=M(" ï½ ",-1)),t("span",Be,c(k.value.dateDisplay),1),M(" "+c(k.value.timeDisplay),1)],64)):(l(),i(_,{key:1},[M(c(k.value.text),1)],64))])],2),t("section",Ee,[e[9]||(e[9]=t("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),t("div",Re,[t("div",$e,[(l(),i(_,null,F(Y,n=>t("span",{key:n,class:"heatmap-week-label"},c(n),1)),64)),(l(!0),i(_,null,F(ee.value,(n,N)=>(l(),i(_,{key:N},[n.empty?(l(),i("span",Ne)):(l(),i("span",{key:1,class:O(["heatmap-cell",n.level]),title:n.title},c(n.count||""),11,Ue))],64))),128))])])])]),v.value?(l(),z(_e,{key:0,open:v.value,"onUpdate:open":e[2]||(e[2]=n=>v.value=n),message:j.value},null,8,["open","message"])):oe("",!0)])}}};export{Ke as default};
