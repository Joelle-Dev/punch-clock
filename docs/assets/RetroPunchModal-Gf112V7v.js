import{p as G,r as k,i as E,q as U,x as K,d as r,y as J,z as Q,h as C,A as W,C as g,D as X,E as Z,_ as ee,G as te,u as ne,H as ae,I as T,o as F,c as oe,w as S,a as B,P as le,m as I,j as se,F as ie,l as ue,B as me,e as re}from"./index-X1Z84OWo.js";/* empty css              */import{f as ce,p as de,P as ve,g as R,s as pe,D as fe}from"./index-BxVikA5j.js";import{F as he}from"./index-C-V46Kl7.js";import{_ as ye}from"./BaseModal-CeGSKcLT.js";import{u as Te}from"./useDoubleTapHint-pHmDMh-t.js";import{T as ke,a as be}from"./index-BJMF_AxL.js";import"./use-id-BRxWW_Vv.js";const[_e]=X("time-picker"),j=n=>/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/.test(n),ge=["hour","minute","second"],xe=W({},pe,{minHour:g(0),maxHour:g(23),minMinute:g(0),maxMinute:g(59),minSecond:g(0),maxSecond:g(59),minTime:{type:String,validator:j},maxTime:{type:String,validator:j},columnsType:{type:Array,default:()=>["hour","minute"]}});var Se=G({name:_e,props:xe,emits:["confirm","cancel","change","update:modelValue"],setup(n,{emit:b,slots:D}){const l=k(n.modelValue),x=k(),P=e=>{const s=e.split(":");return ge.map((u,i)=>n.columnsType.includes(u)?s[i]:"00")},Y=()=>{var e;return(e=x.value)==null?void 0:e.confirm()},A=()=>l.value,w=C(()=>{let{minHour:e,maxHour:s,minMinute:u,maxMinute:i,minSecond:d,maxSecond:M}=n;if(n.minTime||n.maxTime){const c={hour:0,minute:0,second:0};n.columnsType.forEach((f,h)=>{var p;c[f]=(p=l.value[h])!=null?p:0});const{hour:m,minute:v}=c;if(n.minTime){const[f,h,p]=P(n.minTime);e=f,u=+m<=+e?h:"00",d=+m<=+e&&+v<=+u?p:"00"}if(n.maxTime){const[f,h,p]=P(n.maxTime);s=f,i=+m>=+s?h:"59",M=+m>=+s&&+v>=+i?p:"59"}}return n.columnsType.map(c=>{const{filter:m,formatter:v}=n;switch(c){case"hour":return R(+e,+s,c,v,m,l.value);case"minute":return R(+u,+i,c,v,m,l.value);case"second":return R(+d,+M,c,v,m,l.value);default:return[]}})});E(l,e=>{U(e,n.modelValue)||b("update:modelValue",e)}),E(()=>n.modelValue,e=>{e=ce(e,w.value),U(e,l.value)||(l.value=e)},{immediate:!0});const H=(...e)=>b("change",...e),N=(...e)=>b("cancel",...e),$=(...e)=>b("confirm",...e);return K({confirm:Y,getSelectedTime:A}),()=>r(ve,J({ref:x,modelValue:l.value,"onUpdate:modelValue":e=>l.value=e,columns:w.value,onChange:H,onCancel:N,onConfirm:$},Q(n,de)),D)}});const Ce=Z(Se),De={class:"retro-punch-type-section"},Pe={__name:"RetroPunchModal",props:{open:Boolean},emits:["update:open"],setup(n,{emit:b}){const D=n,l=b,x=C({get:()=>D.open,set:a=>l("update:open",a)}),{records:P,addRecordAt:Y}=te(),{checkAll:A}=ne(),w=ae("showAchievementToast",()=>{});Te({messages:["补上瘾啦？","再补要收小费啦～","手下留情嘛～"]});const H=[{type:"toilet",label:"如厕"},{type:"meal",label:"饭否"},{type:"fitness",label:"健身"}],N=new Date(T().subtract(1,"year").valueOf()),$=new Date(T().valueOf()),e=k(""),s=k("12:00"),u=k("toilet"),i=k(!1),d=k(!1),M=C(()=>e.value?T(e.value).format("YYYY年M月D日"):""),c=C(()=>{if(!e.value)return[];const a=T(e.value);return[String(a.year()),String(a.month()+1),String(a.date())]}),m=C(()=>{const[a,t]=(s.value||"12:00").split(":").map(Number);return[String(a||0),String(t||0)]});function v({selectedValues:a}={}){const t=a||[];if(t.length>=3){const[y,V,_]=t.map(Number);e.value=T().year(y).month(V-1).date(_).format("YYYY-MM-DD")}i.value=!1}function f({selectedValues:a}={}){const t=a||[];t.length>=2&&(s.value=`${String(t[0]).padStart(2,"0")}:${String(t[1]).padStart(2,"0")}`),d.value=!1}function h(){e.value=T().subtract(1,"day").format("YYYY-MM-DD"),s.value="12:00",u.value="toilet"}E(()=>D.open,a=>{a&&h()},{immediate:!0});function p(){const[a,t]=(s.value||"12:00").split(":").map(Number),y=T(e.value).hour(a||0).minute(t||0).second(0).millisecond(0);y.isValid()&&(Y(y,u.value),l("update:open",!1),setTimeout(()=>{A(P.value).forEach(_=>w(_))},0))}return(a,t)=>{const y=he,V=fe,_=le,O=Ce,L=be,q=ke,z=me;return F(),oe(ye,{open:x.value,"onUpdate:open":t[7]||(t[7]=o=>x.value=o),title:"补一下～"},{default:S(()=>[t[10]||(t[10]=B("p",{class:"retro-punch-hint"},"选一下忘打我的那天、时间和类型呀～",-1)),r(y,{"model-value":M.value,label:"日期",readonly:"","is-link":"",placeholder:"选择日期",onClick:t[0]||(t[0]=o=>i.value=!0)},null,8,["model-value"]),r(y,{"model-value":s.value,label:"时间",readonly:"","is-link":"",placeholder:"选择时间",onClick:t[1]||(t[1]=o=>d.value=!0)},null,8,["model-value"]),r(_,{show:i.value,"onUpdate:show":t[3]||(t[3]=o=>i.value=o),position:"bottom",round:""},{default:S(()=>[r(V,{"model-value":c.value,"min-date":I(N),"max-date":I($),title:"选择日期",onConfirm:v,onCancel:t[2]||(t[2]=o=>i.value=!1)},null,8,["model-value","min-date","max-date"])]),_:1},8,["show"]),r(_,{show:d.value,"onUpdate:show":t[5]||(t[5]=o=>d.value=o),position:"bottom",round:""},{default:S(()=>[r(O,{"model-value":m.value,title:"选择时间",onConfirm:f,onCancel:t[4]||(t[4]=o=>d.value=!1)},null,8,["model-value"])]),_:1},8,["show"]),B("div",De,[t[8]||(t[8]=B("span",{class:"retro-punch-label"},"类型",-1)),r(q,{active:u.value,"onUpdate:active":t[6]||(t[6]=o=>u.value=o),type:"card",shrink:"",class:"retro-punch-type-tabs"},{default:S(()=>[(F(),se(ie,null,ue(H,o=>r(L,{key:o.type,name:o.type,title:o.label},null,8,["name","title"])),64))]),_:1},8,["active"])]),r(z,{type:"primary",block:"",round:"",class:"retro-punch-submit",onClick:p},{default:S(()=>[...t[9]||(t[9]=[re(" 补上～ ",-1)])]),_:1})]),_:1},8,["open"])}}},Be=ee(Pe,[["__scopeId","data-v-fa454cce"]]);export{Be as default};
