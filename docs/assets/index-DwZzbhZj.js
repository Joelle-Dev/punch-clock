import{C as R,K as Oe,z as V,L as j,m as q,M as Z,N as ue,q as J,O as xe,Q as re,d as b,R as K,S as F,r as w,T as me,U as Te,h as x,V as te,W as de,A as U,i as $,p as Y,X as ke,Y as Ce,Z as ne,y as W,x as fe,_ as Me,$ as Pe,a0 as we,D as ve,a1 as he,a2 as ae}from"./index-D_m1KBBi.js";const[Ee,P,oe]=R("picker"),ge=e=>e.find(a=>!a.disabled)||e[0];function Se(e,a){const t=e[0];if(t){if(Array.isArray(t))return"multiple";if(a.children in t)return"cascade"}return"default"}function L(e,a){a=j(a,0,e.length);for(let t=a;t<e.length;t++)if(!e[t].disabled)return t;for(let t=a-1;t>=0;t--)if(!e[t].disabled)return t;return 0}const le=(e,a,t)=>a!==void 0&&e.some(i=>i[t.value]===a);function X(e,a,t){const i=e.findIndex(f=>f[t.value]===a),c=L(e,i);return e[c]}function Ve(e,a,t){const i=[];let c={[a.children]:e},f=0;for(;c&&c[a.children];){const d=c[a.children],h=t.value[f];if(c=Oe(h)?X(d,h,a):void 0,!c&&d.length){const u=ge(d)[a.value];c=X(d,u,a)}f++,i.push(d)}return i}function Ie(e){const{transform:a}=window.getComputedStyle(e),t=a.slice(7,a.length-1).split(", ")[5];return Number(t)}function He(e){return V({text:"text",value:"value",children:"children"},e)}const ce=200,ie=300,Ne=15,[ye,G]=R("picker-column"),be=Symbol(ye);var _e=q({name:ye,props:{value:Z,fields:K(Object),options:F(),readonly:Boolean,allowHtml:Boolean,optionHeight:K(Number),swipeDuration:K(Z),visibleOptionNum:K(Z)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:t}){let i,c,f,d,h;const u=w(),D=w(),g=w(0),v=w(0),T=Te(),E=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=s=>{let m=L(e.options,s);const n=-m*e.optionHeight,l=()=>{m>E()-1&&(m=L(e.options,s));const r=e.options[m][e.fields.value];r!==e.value&&a("change",r)};i&&n!==g.value?h=l:l(),g.value=n},O=()=>e.readonly||!e.options.length,N=s=>{i||O()||(h=null,v.value=ce,k(s),a("clickOption",e.options[s]))},S=s=>j(Math.round(-s/e.optionHeight),0,E()-1),_=x(()=>S(g.value)),p=(s,m)=>{const n=Math.abs(s/m);s=g.value+n/.003*(s<0?-1:1);const l=S(s);v.value=+e.swipeDuration,k(l)},o=()=>{i=!1,v.value=0,h&&(h(),h=null)},y=s=>{if(!O()){if(T.start(s),i){const m=Ie(D.value);g.value=Math.min(0,m-H())}v.value=0,c=g.value,f=Date.now(),d=c,h=null}},C=s=>{if(O())return;T.move(s),T.isVertical()&&(i=!0,me(s,!0));const m=j(c+T.deltaY.value,-(E()*e.optionHeight),e.optionHeight),n=S(m);n!==_.value&&a("scrollInto",e.options[n]),g.value=m;const l=Date.now();l-f>ie&&(f=l,d=m)},M=()=>{if(O())return;const s=g.value-d,m=Date.now()-f;if(m<ie&&Math.abs(s)>Ne){p(s,m);return}const l=S(g.value);v.value=ce,k(l),setTimeout(()=>{i=!1},0)},I=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((m,n)=>{const l=m[e.fields.text],{disabled:r}=m,A=m[e.fields.value],B={role:"button",style:s,tabindex:r?-1:0,class:[G("item",{disabled:r,selected:A===e.value}),m.className],onClick:()=>N(n)},De={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return b("li",B,[t.option?t.option(m,n):b("div",De,null)])})};return ue(be),J({stopMomentum:o}),xe(()=>{const s=i?Math.floor(-g.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),m=L(e.options,s),n=-m*e.optionHeight;i&&m<s&&o(),g.value=n}),re("touchmove",C,{target:u}),()=>b("div",{ref:u,class:G(),onTouchstartPassive:y,onTouchend:M,onTouchcancel:M},[b("ul",{ref:D,style:{transform:`translate3d(0, ${g.value+H()}px, 0)`,transitionDuration:`${v.value}ms`,transitionProperty:v.value?"all":"none"},class:G("wrapper"),onTransitionend:o},[I()])])}});const[Ye]=R("picker-toolbar"),z={title:String,cancelButtonText:String,confirmButtonText:String},pe=["cancel","confirm","title","toolbar"],Be=Object.keys(z);var $e=q({name:Ye,props:z,emits:["confirm","cancel"],setup(e,{emit:a,slots:t}){const i=()=>{if(t.title)return t.title();if(e.title)return b("div",{class:[P("title"),"van-ellipsis"]},[e.title])},c=()=>a("cancel"),f=()=>a("confirm"),d=()=>{var u;const D=(u=e.cancelButtonText)!=null?u:oe("cancel");if(!(!t.cancel&&!D))return b("button",{type:"button",class:[P("cancel"),te],onClick:c},[t.cancel?t.cancel():D])},h=()=>{var u;const D=(u=e.confirmButtonText)!=null?u:oe("confirm");if(!(!t.confirm&&!D))return b("button",{type:"button",class:[P("confirm"),te],onClick:f},[t.confirm?t.confirm():D])};return()=>b("div",{class:P("toolbar")},[t.toolbar?t.toolbar():[d(),i(),h()]])}});const[Fe]=R("picker-group"),Re=Symbol(Fe);V({tabs:F(),activeTab:U(0),nextStepText:String,showToolbar:de},z);const ee=V({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:U(44),showToolbar:de,swipeDuration:U(1e3),visibleOptionNum:U(6)},z),Ae=V({},ee,{columns:F(),modelValue:F(),toolbarPosition:Me("top"),columnsFieldNames:Object});var Ke=q({name:Ee,props:Ae,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:t}){const i=w(),c=w(e.modelValue.slice(0)),{parent:f}=ue(Re),{children:d,linkChildren:h}=Ce(be);h();const u=x(()=>He(e.columnsFieldNames)),D=x(()=>Pe(e.optionHeight)),g=x(()=>Se(e.columns,u.value)),v=x(()=>{const{columns:n}=e;switch(g.value){case"multiple":return n;case"cascade":return Ve(n,u.value,c);default:return[n]}}),T=x(()=>v.value.some(n=>n.length)),E=x(()=>v.value.map((n,l)=>X(n,c.value[l],u.value))),H=x(()=>v.value.map((n,l)=>n.findIndex(r=>r[u.value.value]===c.value[l]))),k=(n,l)=>{if(c.value[n]!==l){const r=c.value.slice(0);r[n]=l,c.value=r}},O=()=>({selectedValues:c.value.slice(0),selectedOptions:E.value,selectedIndexes:H.value}),N=(n,l)=>{k(l,n),g.value==="cascade"&&c.value.forEach((r,A)=>{const B=v.value[A];le(B,r,u.value)||k(A,B.length?B[0][u.value.value]:void 0)}),ne(()=>{a("change",V({columnIndex:l},O()))})},S=(n,l)=>{const r={columnIndex:l,currentOption:n};a("clickOption",V(O(),r)),a("scrollInto",r)},_=()=>{d.forEach(l=>l.stopMomentum());const n=O();return ne(()=>{const l=O();a("confirm",l)}),n},p=()=>a("cancel",O()),o=()=>v.value.map((n,l)=>b(_e,{value:c.value[l],fields:u.value,options:n,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:D.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:r=>N(r,l),onClickOption:r=>S(r,l),onScrollInto:r=>{a("scrollInto",{currentOption:r,columnIndex:l})}},{option:t.option})),y=n=>{if(T.value){const l={height:`${D.value}px`},r={backgroundSize:`100% ${(n-D.value)/2}px`};return[b("div",{class:P("mask"),style:r},null),b("div",{class:[we,P("frame")],style:l},null)]}},C=()=>{const n=D.value*+e.visibleOptionNum,l={height:`${n}px`};return!e.loading&&!T.value&&t.empty?t.empty():b("div",{ref:i,class:P("columns"),style:l},[o(),y(n)])},M=()=>{if(e.showToolbar&&!f)return b($e,fe(W(e,Be),{onConfirm:_,onCancel:p}),W(t,pe))},I=n=>{n.forEach((l,r)=>{l.length&&!le(l,c.value[r],u.value)&&k(r,ge(l)[u.value.value])})};$(v,n=>I(n),{immediate:!0});let s;return $(()=>e.modelValue,n=>{!Y(n,c.value)&&!Y(n,s)&&(c.value=n.slice(0),s=n.slice(0)),e.modelValue.length===0&&I(v.value)},{deep:!0}),$(c,n=>{Y(n,e.modelValue)||(s=n.slice(0),a("update:modelValue",s))},{immediate:!0}),re("touchmove",me,{target:i}),J({confirm:_,getSelectedOptions:()=>E.value}),()=>{var n,l;return b("div",{class:P()},[e.toolbarPosition==="top"?M():null,e.loading?b(ke,{class:P("loading")},null):null,(n=t["columns-top"])==null?void 0:n.call(t),C(),(l=t["columns-bottom"])==null?void 0:l.call(t),e.toolbarPosition==="bottom"?M():null])}}});const Ue=ve(Ke),Le=V({},ee,{modelValue:F(),filter:Function,formatter:{type:Function,default:(e,a)=>a}}),je=Object.keys(ee);function qe(e,a){if(e<0)return[];const t=Array(e);let i=-1;for(;++i<e;)t[i]=a(i);return t}const ze=(e,a)=>32-new Date(e,a-1,32).getDate(),Q=(e,a,t,i,c,f)=>{const d=qe(a-e+1,h=>{const u=he(e+h);return i(t,{text:u,value:u})});return c?c(t,d,f):d},Ze=(e,a)=>e.map((t,i)=>{const c=a[i];if(c.length){const f=+c[0].value,d=+c[c.length-1].value;return he(j(+t,f,d))}return t}),se=new Date().getFullYear(),[Ge]=R("date-picker"),Qe=V({},Le,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(se-10,0,1),validator:ae},maxDate:{type:Date,default:()=>new Date(se+10,11,31),validator:ae}});var We=q({name:Ge,props:Qe,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:a,slots:t}){const i=w(e.modelValue),c=w(!1),f=w(),d=x(()=>c.value?e.modelValue:i.value),h=o=>o===e.minDate.getFullYear(),u=o=>o===e.maxDate.getFullYear(),D=o=>o===e.minDate.getMonth()+1,g=o=>o===e.maxDate.getMonth()+1,v=o=>{const{minDate:y,columnsType:C}=e,M=C.indexOf(o),I=d.value[M];if(I)return+I;switch(o){case"year":return y.getFullYear();case"month":return y.getMonth()+1;case"day":return y.getDate()}},T=()=>{const o=e.minDate.getFullYear(),y=e.maxDate.getFullYear();return Q(o,y,"year",e.formatter,e.filter,d.value)},E=()=>{const o=v("year"),y=h(o)?e.minDate.getMonth()+1:1,C=u(o)?e.maxDate.getMonth()+1:12;return Q(y,C,"month",e.formatter,e.filter,d.value)},H=()=>{const o=v("year"),y=v("month"),C=h(o)&&D(y)?e.minDate.getDate():1,M=u(o)&&g(y)?e.maxDate.getDate():ze(o,y);return Q(C,M,"day",e.formatter,e.filter,d.value)},k=()=>{var o;return(o=f.value)==null?void 0:o.confirm()},O=()=>i.value,N=x(()=>e.columnsType.map(o=>{switch(o){case"year":return T();case"month":return E();case"day":return H();default:return[]}}));$(i,o=>{Y(o,e.modelValue)||a("update:modelValue",o)}),$(()=>e.modelValue,(o,y)=>{c.value=Y(y,i.value),o=Ze(o,N.value),Y(o,i.value)||(i.value=o),c.value=!1},{immediate:!0});const S=(...o)=>a("change",...o),_=(...o)=>a("cancel",...o),p=(...o)=>a("confirm",...o);return J({confirm:k,getSelectedDate:O}),()=>b(Ue,fe({ref:f,modelValue:i.value,"onUpdate:modelValue":o=>i.value=o,columns:N.value,onChange:S,onCancel:_,onConfirm:p},W(e,je)),t)}});const Je=ve(We);export{Je as D,Ue as P,Ze as f,Q as g,je as p,Le as s};
