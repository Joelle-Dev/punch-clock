import{i as oe,o,c as K,w as H,a as t,t as i,d as O,B as X,e as x,r as _,h as g,Z as J,E as le,a3 as ie,j as p,u as m,k as Q,F as b,l as z,n as I,G as q,a4 as ce,a5 as re,H as ue}from"./index-QHLLLVjm.js";/* empty css              */import{u as pe}from"./useAchievements-C4jT47Pq.js";import{u as de}from"./useDoubleTapHint-CfP25gJz.js";import{_ as me}from"./BaseModal-CA2Kxisn.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as ve,a as fe}from"./index-DpY_RwNX.js";import"./use-id-Da5vf7Vg.js";function ye(k,r){const c=r&&String(r).trim()?String(r).trim():"ç§‹ç‘¾";switch(k){case"toilet":return c+"åˆæ‹‰ç²‘ç²‘å•¦ï½ž";case"meal":return c+"çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½ž";case"fitness":return c+"å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½ž";default:return c+"çœŸæ£’ï½ž"}}const be={class:"punch-success-message"},_e={__name:"PunchSuccessModal",props:{open:Boolean,message:{type:String,default:""}},emits:["update:open"],setup(k,{emit:r}){const c=k,C=r,h=g({get:()=>c.open,set:l=>C("update:open",l)}),f=_(null),j=["â™¥","âœ¨","â˜…","â˜†","â€¢","â™¥","âœ¨","â˜…"],T=["celebrate-float","celebrate-twinkle","celebrate-rise"],L=["#ff6b9d","#e84c7a","#ffd700","#ffb347","#c2185b","#f8bbd9"];function R(){if(f.value){f.value.innerHTML="";for(let l=0;l<28;l++){const n=document.createElement("span");n.className="celebrate-item "+T[l%T.length],n.textContent=j[l%j.length],n.style.left=Math.random()*80+10+"%",n.style.top=Math.random()*80+10+"%",n.style.animationDelay=Math.random()*.8+"s",n.style.color=L[l%L.length],n.style.fontSize=12+Math.random()*12+"px",f.value.appendChild(n)}}}function A(){J(()=>{requestAnimationFrame(()=>{J(()=>{R(),setTimeout(R,80)})})})}function $(){C("update:open",!1)}return oe(()=>c.open,l=>{l&&A()},{immediate:!0}),(l,n)=>{const W=X;return o(),K(me,{open:h.value,"onUpdate:open":n[0]||(n[0]=d=>h.value=d),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:H(()=>[t("div",{ref_key:"celebrationRef",ref:f,class:"punch-success-celebration","aria-hidden":"true"},null,512),t("div",be,i(k.message),1),O(W,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:$},{default:H(()=>[...n[1]||(n[1]=[x("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},ge=he(_e,[["__scopeId","data-v-4d06afb7"]]),ke={class:"tab-panel active punch-panel"},Te={class:"app-header"},we={class:"stats-row"},Se={class:"stat-card"},De={class:"stat-value"},Me={class:"stat-card"},xe={class:"stat-value"},Ce={class:"stat-value"},je={key:0,class:"stat-achievement-hint"},Le={class:"app-main"},Re={class:"type-section","aria-label":"é€‰æ‹©ç±»åž‹"},Ae={class:"punch-button-inner"},$e={class:"punch-icon","aria-hidden":"true"},Be={class:"last-punch"},Ne={class:"last-punch-type"},Pe={class:"last-punch-date"},Ee={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},He={class:"heatmap-container"},Ve={class:"heatmap-grid"},Fe={key:0,class:"heatmap-cell heatmap-cell-empty"},Ue=["title"],Je={__name:"PunchView",setup(k){var Z;const{records:r,todayCount:c,streak:C,lastRecord:h,addRecord:f,getMonthHeatmap:j}=le(),{unlockedList:T,achievements:L,checkAll:R}=pe(),A=g(()=>{const s=T.value;if(!s.length)return"";const e=s[s.length-1],u=L.find(D=>D.id===e);return(u==null?void 0:u.title)??""}),$=q("openAchievementModal",()=>{}),l=q("showAchievementToast",()=>{}),n=q("userName",_("")),d=_(["toilet","meal","fitness","other"].includes((Z=h.value)==null?void 0:Z.type)?h.value.type:"fitness"),w=_(!1),B=_(!1),G=_(""),{shouldSkipDueToDoubleTap:Y}=de(),N=[{type:"toilet",label:"å¦‚åŽ•",emoji:"ðŸš½",short:"åŽ•",tint:"#4caf50"},{type:"meal",label:"é¥­å¦",emoji:"ðŸš",short:"é¥­",tint:"#ff9800"},{type:"fitness",label:"å¥èº«",emoji:"ðŸ’ª",short:"èº«",tint:"#2196f3"},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0"}].map(s=>({...s,tabTitle:s.emoji+" "+s.short})),P=g(()=>N.find(s=>s.type===d.value)||N[0]);function ee(s){var e;return((e=N.find(u=>u.type===s))==null?void 0:e.label)??"å…¶ä»–"}const te=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],S=g(()=>{if(!h.value)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const s=h.value;return{hasRecord:!0,typeLabel:ee(s.type||"other"),dateDisplay:re(s.dateKey),timeDisplay:ce(s.timestamp)}}),se=g(()=>ue()),ae=g(()=>{const s=se.value,e=s.year(),u=s.month()+1,D=j(r.value,e,u),E=s.startOf("month"),a=E.daysInMonth(),V=E.day(),F=[];for(let y=0;y<V;y++)F.push({empty:!0});for(let y=1;y<=a;y++){const U=`${e}-${String(u).padStart(2,"0")}-${String(y).padStart(2,"0")}`,v=D[U]||0;let M="heatmap-cell-0";v>=6?M="heatmap-cell-4":v>=4?M="heatmap-cell-3":v>=2?M="heatmap-cell-2":v>=1&&(M="heatmap-cell-1"),F.push({empty:!1,count:v,level:M,title:v?`${U} æ‰“æˆ‘ ${v} æ¬¡`:U})}return F});function ne(){Y(d.value)||(G.value=ye(d.value,n.value&&n.value.trim()?n.value.trim():"ç§‹ç‘¾"),B.value=!0,f(d.value),w.value=!0,requestAnimationFrame(()=>{w.value=!1,document.body.offsetHeight,w.value=!0,setTimeout(()=>w.value=!1,450)}),setTimeout(()=>{R(r.value).forEach(e=>l(e))},0))}return ie(()=>{const s=()=>{r.value=[...r.value]};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&s()}),window.addEventListener("pageshow",e=>{e.persisted&&s()})}),(s,e)=>{const u=fe,D=ve,E=X;return o(),p("div",ke,[t("header",Te,[t("div",we,[t("div",Se,[t("span",De,i(m(c)),1),e[3]||(e[3]=t("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),t("div",Me,[t("span",xe,i(m(C)),1),e[4]||(e[4]=t("span",{class:"stat-label"},"è¿žç»­",-1))]),t("div",{class:"stat-card stat-card-achievement",onClick:e[0]||(e[0]=(...a)=>m($)&&m($)(...a))},[t("span",Ce,i(m(T).length),1),e[5]||(e[5]=t("span",{class:"stat-label"},"æˆå°±",-1)),A.value?(o(),p("span",je,i(A.value),1)):Q("",!0)])])]),t("main",Le,[t("section",Re,[O(D,{active:d.value,"onUpdate:active":e[1]||(e[1]=a=>d.value=a),shrink:""},{default:H(()=>[(o(!0),p(b,null,z(m(N),a=>(o(),K(u,{key:a.type,name:a.type,title:a.tabTitle},null,8,["name","title"]))),128))]),_:1},8,["active"])]),t("section",{class:I(["punch-section",{"punch-section--first":m(c)===0}])},[O(E,{type:"primary",round:"",size:"large",class:I(["punch-button",["punch-button--"+d.value,{"punch-button-bounce":w.value},{"punch-button--first":m(c)===0}]]),"aria-label":P.value?P.value.emoji+" æ‰“æˆ‘":"æ‰“æˆ‘",onClick:ne},{default:H(()=>[t("span",Ae,[t("span",$e,i(P.value?P.value.emoji:"ðŸ‘Š"),1),e[6]||(e[6]=t("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),t("p",Be,[S.value.hasRecord?(o(),p(b,{key:0},[e[7]||(e[7]=x("ä¸Šæ¬¡æ˜¯ ",-1)),t("span",Ne,i(S.value.typeLabel),1),e[8]||(e[8]=x(" ï½ž ",-1)),t("span",Pe,i(S.value.dateDisplay),1),x(" "+i(S.value.timeDisplay),1)],64)):(o(),p(b,{key:1},[x(i(S.value.text),1)],64))])],2),t("section",Ee,[e[9]||(e[9]=t("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),t("div",He,[t("div",Ve,[(o(),p(b,null,z(te,a=>t("span",{key:a,class:"heatmap-week-label"},i(a),1)),64)),(o(!0),p(b,null,z(ae.value,(a,V)=>(o(),p(b,{key:V},[a.empty?(o(),p("span",Fe)):(o(),p("span",{key:1,class:I(["heatmap-cell",a.level]),title:a.title},i(a.count||""),11,Ue))],64))),128))])])])]),B.value?(o(),K(ge,{key:0,open:B.value,"onUpdate:open":e[2]||(e[2]=a=>B.value=a),message:G.value},null,8,["open","message"])):Q("",!0)])}}};export{Je as default};
