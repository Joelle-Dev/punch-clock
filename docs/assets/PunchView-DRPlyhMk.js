import{i as ce,o as l,c as O,w as N,a as t,t as i,d as W,B as te,e as C,r as g,h as f,Z as Y,E as re,a3 as ue,a4 as pe,j as u,u as d,k as ee,F as _,l as I,n as q,G as K,a5 as de,a6 as me,H as he}from"./index-D_m1KBBi.js";/* empty css              */import{u as ve}from"./useAchievements-Dx7TYuMq.js";import{u as fe}from"./useDoubleTapHint-BC64bXRH.js";import{_ as ye}from"./BaseModal-ZYORZ3OE.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as _e,a as ge}from"./index-DlRXj4D8.js";import"./use-id-CbJ56Ing.js";function ke(k,p){const c=p&&String(p).trim()?String(p).trim():"ç§‹ç‘¾";switch(k){case"toilet":return c+"åˆæ‹‰ç²‘ç²‘å•¦ï½ž";case"meal":return c+"çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½ž";case"fitness":return c+"å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½ž";default:return c+"çœŸæ£’ï½ž"}}const Te={class:"punch-success-message"},we={__name:"PunchSuccessModal",props:{open:Boolean,message:{type:String,default:""}},emits:["update:open"],setup(k,{emit:p}){const c=k,x=p,m=f({get:()=>c.open,set:o=>x("update:open",o)}),y=g(null),L=["â™¥","âœ¨","â˜…","â˜†","â€¢","â™¥","âœ¨","â˜…"],T=["celebrate-float","celebrate-twinkle","celebrate-rise"],j=["#ff6b9d","#e84c7a","#ffd700","#ffb347","#c2185b","#f8bbd9"];function E(){if(y.value){y.value.innerHTML="";for(let o=0;o<28;o++){const n=document.createElement("span");n.className="celebrate-item "+T[o%T.length],n.textContent=L[o%L.length],n.style.left=Math.random()*80+10+"%",n.style.top=Math.random()*80+10+"%",n.style.animationDelay=Math.random()*.8+"s",n.style.color=j[o%j.length],n.style.fontSize=12+Math.random()*12+"px",y.value.appendChild(n)}}}function V(){Y(()=>{requestAnimationFrame(()=>{Y(()=>{E(),setTimeout(E,80)})})})}function R(){x("update:open",!1)}return ce(()=>c.open,o=>{o&&V()},{immediate:!0}),(o,n)=>{const w=te;return l(),O(ye,{open:m.value,"onUpdate:open":n[0]||(n[0]=G=>m.value=G),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:N(()=>[t("div",{ref_key:"celebrationRef",ref:y,class:"punch-success-celebration","aria-hidden":"true"},null,512),t("div",Te,i(k.message),1),W(w,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:R},{default:N(()=>[...n[1]||(n[1]=[C("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},Me=be(we,[["__scopeId","data-v-4d06afb7"]]),Se={class:"tab-panel active punch-panel"},De={class:"app-header"},Ce={class:"stats-row"},xe={class:"stat-card"},Le={class:"stat-value"},je={class:"stat-card"},Ee={class:"stat-value"},Re={class:"stat-value"},Ae={key:0,class:"stat-achievement-hint"},Pe={class:"app-main"},$e={class:"type-section","aria-label":"é€‰æ‹©ç±»åž‹"},Be={class:"punch-button-inner"},Ne={class:"punch-icon","aria-hidden":"true"},Ve={class:"last-punch"},He={class:"last-punch-type"},Ue={class:"last-punch-date"},Fe={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},ze={class:"heatmap-container"},Ie={class:"heatmap-grid"},qe={key:0,class:"heatmap-cell heatmap-cell-empty"},Ke=["title"],et={__name:"PunchView",setup(k){var X;const{records:p,todayCount:c,streak:x,lastRecord:m,addRecord:y,getMonthHeatmap:L}=re(),{unlockedList:T,achievements:j,checkAll:E}=ve(),V=f(()=>{const s=new Map;return j.forEach(e=>{s.set(e.id,e)}),s}),R=f(()=>{const s=T.value;if(!s.length)return"";const e=s[s.length-1],r=V.value.get(e);return(r==null?void 0:r.title)??""}),o=K("openAchievementModal",()=>{}),n=K("showAchievementToast",()=>{}),w=K("userName",g("")),h=g(["toilet","meal","fitness","other"].includes((X=m.value)==null?void 0:X.type)?m.value.type:"fitness"),M=g(!1),A=g(!1),Z=g(""),{shouldSkipDueToDoubleTap:se}=fe(),P=[{type:"toilet",label:"å¦‚åŽ•",emoji:"ðŸš½",short:"åŽ•",tint:"#4caf50"},{type:"meal",label:"é¥­å¦",emoji:"ðŸš",short:"é¥­",tint:"#ff9800"},{type:"fitness",label:"å¥èº«",emoji:"ðŸ’ª",short:"èº«",tint:"#2196f3"},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0"}].map(s=>({...s,tabTitle:s.emoji+" "+s.short})),$=f(()=>P.find(s=>s.type===h.value)||P[0]);function ae(s){var e;return((e=P.find(r=>r.type===s))==null?void 0:e.label)??"å…¶ä»–"}const ne=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],S=f(()=>{if(!m.value)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const s=m.value;return{hasRecord:!0,typeLabel:ae(s.type||"other"),dateDisplay:me(s.dateKey),timeDisplay:de(s.timestamp)}}),oe=f(()=>he()),le=f(()=>{const s=oe.value,e=s.year(),r=s.month()+1,H=L(p.value,e,r),B=s.startOf("month"),a=B.daysInMonth(),U=B.day(),F=[];for(let b=0;b<U;b++)F.push({empty:!0});for(let b=1;b<=a;b++){const z=`${e}-${String(r).padStart(2,"0")}-${String(b).padStart(2,"0")}`,v=H[z]||0;let D="heatmap-cell-0";v>=6?D="heatmap-cell-4":v>=4?D="heatmap-cell-3":v>=2?D="heatmap-cell-2":v>=1&&(D="heatmap-cell-1"),F.push({empty:!1,count:v,level:D,title:v?`${z} æ‰“æˆ‘ ${v} æ¬¡`:z})}return F});function ie(){se(h.value)||(Z.value=ke(h.value,w.value&&w.value.trim()?w.value.trim():"ç§‹ç‘¾"),A.value=!0,y(h.value),M.value=!0,requestAnimationFrame(()=>{M.value=!1,document.body.offsetHeight,M.value=!0,setTimeout(()=>M.value=!1,450)}),setTimeout(()=>{E(p.value).forEach(e=>n(e))},0))}const J=()=>{document.visibilityState==="visible"&&refresh()},Q=s=>{s.persisted&&refresh()};return ue(()=>{document.addEventListener("visibilitychange",J),window.addEventListener("pageshow",Q)}),pe(()=>{document.removeEventListener("visibilitychange",J),window.removeEventListener("pageshow",Q)}),(s,e)=>{const r=ge,H=_e,B=te;return l(),u("div",Se,[t("header",De,[t("div",Ce,[t("div",xe,[t("span",Le,i(d(c)),1),e[3]||(e[3]=t("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),t("div",je,[t("span",Ee,i(d(x)),1),e[4]||(e[4]=t("span",{class:"stat-label"},"è¿žç»­",-1))]),t("div",{class:"stat-card stat-card-achievement",onClick:e[0]||(e[0]=(...a)=>d(o)&&d(o)(...a))},[t("span",Re,i(d(T).length),1),e[5]||(e[5]=t("span",{class:"stat-label"},"æˆå°±",-1)),R.value?(l(),u("span",Ae,i(R.value),1)):ee("",!0)])])]),t("main",Pe,[t("section",$e,[W(H,{active:h.value,"onUpdate:active":e[1]||(e[1]=a=>h.value=a),shrink:""},{default:N(()=>[(l(!0),u(_,null,I(d(P),a=>(l(),O(r,{key:a.type,name:a.type,title:a.tabTitle},null,8,["name","title"]))),128))]),_:1},8,["active"])]),t("section",{class:q(["punch-section",{"punch-section--first":d(c)===0}])},[W(B,{type:"primary",round:"",size:"large",class:q(["punch-button",["punch-button--"+h.value,{"punch-button-bounce":M.value},{"punch-button--first":d(c)===0}]]),"aria-label":$.value?$.value.emoji+" æ‰“æˆ‘":"æ‰“æˆ‘",onClick:ie},{default:N(()=>[t("span",Be,[t("span",Ne,i($.value?$.value.emoji:"ðŸ‘Š"),1),e[6]||(e[6]=t("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),t("p",Ve,[S.value.hasRecord?(l(),u(_,{key:0},[e[7]||(e[7]=C("ä¸Šæ¬¡æ˜¯ ",-1)),t("span",He,i(S.value.typeLabel),1),e[8]||(e[8]=C(" ï½ž ",-1)),t("span",Ue,i(S.value.dateDisplay),1),C(" "+i(S.value.timeDisplay),1)],64)):(l(),u(_,{key:1},[C(i(S.value.text),1)],64))])],2),t("section",Fe,[e[9]||(e[9]=t("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),t("div",ze,[t("div",Ie,[(l(),u(_,null,I(ne,a=>t("span",{key:a,class:"heatmap-week-label"},i(a),1)),64)),(l(!0),u(_,null,I(le.value,(a,U)=>(l(),u(_,{key:U},[a.empty?(l(),u("span",qe)):(l(),u("span",{key:1,class:q(["heatmap-cell",a.level]),title:a.title},i(a.count||""),11,Ke))],64))),128))])])])]),A.value?(l(),O(Me,{key:0,open:A.value,"onUpdate:open":e[2]||(e[2]=a=>A.value=a),message:Z.value},null,8,["open","message"])):ee("",!0)])}}};export{et as default};
