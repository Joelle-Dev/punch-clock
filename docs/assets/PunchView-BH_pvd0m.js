import{o as i,j as d,a4 as lt,r as _,i as vt,a5 as gt,c as O,w as K,a as n,F as N,l as H,a6 as yt,t as y,n as st,k as nt,d as ht,B as _t,e as at,h as g,_ as bt,G as At,u as Et,a7 as Lt,m as U,a8 as Ft,H as pt,I as wt,a9 as Bt,aa as Mt}from"./index-Deo0xzB1.js";/* empty css              */import{u as Tt}from"./useDoubleTapHint-9hZhuhZS.js";import{_ as Dt}from"./BaseModal-DunMfYGC.js";import{_ as St}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as $t,a as Nt}from"./index-CJ0kUcnV.js";import"./use-id-BlkIwTWw.js";const It=["width","height"],zt={__name:"ToiletIcon",props:{size:{type:[Number,String],default:24}},setup(p){return(m,c)=>(i(),d("svg",{width:p.size,height:p.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...c[0]||(c[0]=[lt('<g transform="translate(48 48) scale(1.5) translate(-48 -48)"><rect x="26" y="22" rx="6" ry="6" width="28" height="22" fill="#FFFFFF" stroke="#B8C4FF" stroke-width="2"></rect><circle cx="50" cy="28" r="2" fill="#B8C4FF"></circle><rect x="30" y="36" rx="10" ry="10" width="36" height="26" fill="#FFFFFF" stroke="#B8C4FF" stroke-width="2"></rect><ellipse cx="48" cy="50" rx="10" ry="7" fill="#D6E4FF"></ellipse><circle cx="40" cy="44" r="2" fill="#7D8FFF"></circle><circle cx="56" cy="44" r="2" fill="#7D8FFF"></circle><path d="M42 48 C 45 52, 51 52, 54 48" stroke="#FF9BB3" stroke-width="2" fill="none" stroke-linecap="round"></path><path d="M36 62 H60 L56 74 H40 Z" fill="#FFFFFF" stroke="#B8C4FF" stroke-width="2"></path><path d="M32 40 C34 36, 38 34, 42 34" stroke="#EDF1FF" stroke-width="3" fill="none" stroke-linecap="round"></path></g>',1)])],8,It))}},Pt=["width","height"],Rt={__name:"MealIcon",props:{size:{type:[Number,String],default:24}},setup(p){return(m,c)=>(i(),d("svg",{width:p.size,height:p.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...c[0]||(c[0]=[lt(`<g transform="translate(48 52) scale(1.7) translate(-48 -52)"><path d="M32 54
           C 32 50, 36 46, 48 46
           C 60 46, 64 50, 64 54
           C 64 58, 60 62, 48 62
           C 36 62, 32 58, 32 54 Z" fill="#FFFFFF" stroke="#E2C39B" stroke-width="2"></path><path d="M40 62
           C 41 64, 43 66, 48 66
           C 53 66, 55 64, 56 62" fill="#FFFFFF" stroke="#E2C39B" stroke-width="2" stroke-linecap="round"></path><path d="M34 52
           C 36 46, 41 42, 48 42
           C 55 42, 60 46, 62 52
           C 58 54, 53 55.5, 48 56
           C 43 55.5, 38 54.5, 34 52 Z" fill="#FFFFFF" stroke="#F0E4D0" stroke-width="1.4"></path><path d="M40 47 C42.5 46,45 46,47.5 47" stroke="#F7EFE2" stroke-width="1.8" stroke-linecap="round"></path><path d="M49 46.8 C51.5 46,54 46,56 47.2" stroke="#F7EFE2" stroke-width="1.8" stroke-linecap="round"></path><path d="M45 51.5
           C 47.3 50.8, 49.7 50.8, 52 51.7
           C 52.4 53, 52 54.2, 50.9 55.2
           C 49 55.5, 47.5 55.2, 46 54.2
           C 45.5 53.4, 45.3 52.5, 45 51.5 Z" fill="#FFE3A3" stroke="#F2C774" stroke-width="1"></path><path d="M38 53
           C 36.5 52, 35.5 50.5, 36.3 49
           C 37.5 47.5, 39.3 47.4, 41 48.4
           C 42 50, 41.5 51.5, 40 52.8 Z" fill="#B7E08C" stroke="#8FBF63" stroke-width="1"></path><g transform="rotate(-25 60 40)"><rect x="52" y="38" width="24" height="2.6" rx="1.3" fill="#F0B15A"></rect><rect x="54" y="35.6" width="24" height="2.6" rx="1.3" fill="#F0B15A"></rect></g><circle cx="44" cy="58" r="1.3" fill="#D0834A"></circle><circle cx="52" cy="58" r="1.3" fill="#D0834A"></circle><path d="M45.5 60.5 C 47 61.8, 49 61.8, 50.5 60.5" stroke="#FF6B9D" stroke-width="1.5" fill="none" stroke-linecap="round"></path></g>`,1)])],8,Pt))}},Ut=["width","height"],jt={__name:"FitnessIcon",props:{size:{type:[Number,String],default:24}},setup(p){return(m,c)=>(i(),d("svg",{width:p.size,height:p.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...c[0]||(c[0]=[lt(`<g transform="translate(48 48) scale(1.6) translate(-48 -48)"><g transform="translate(0, 4)"><path d="M28 54
             C 30 46, 36 40, 44 38
             C 50 36, 54 38, 56 42
             C 58 46, 56 50, 52 52
             C 48 54, 44 56, 40 58
             C 35 60, 30 60, 28 58
             Z" fill="#FFE0C2" stroke="#E2B194" stroke-width="2" stroke-linejoin="round"></path><path d="M34 50 C 40 46, 48 45, 53 48" stroke="#FFD2AE" stroke-width="2.2" fill="none" stroke-linecap="round"></path><path d="M38 56
             C 44 56, 50 54, 54 50
             C 56 48, 58 46, 60 46
             C 62 46, 64 48, 64 50
             C 64 52, 62 54, 60 55
             C 55 58, 48 60, 42 60
             C 40 60, 38 58, 38 56 Z" fill="#FFE0C2" stroke="#E2B194" stroke-width="2" stroke-linejoin="round"></path><rect x="56" y="46" width="8" height="6" rx="3" fill="#4D7CFF"></rect><path d="M60 40
             C 56 40, 54 42, 54 45
             L 54 50
             C 54 52, 56 54, 58 54
             L 62 54
             C 65 54, 68 52, 68 49
             C 68 46, 66 44, 64 44
             L 62 44
             C 62 42, 61 40, 60 40 Z" fill="#FFE0C2" stroke="#E2B194" stroke-width="2" stroke-linejoin="round"></path></g><g transform="translate(0, 0) rotate(-15 66 26)"><rect x="58" y="24" width="16" height="4" rx="2" fill="#B7C4FF"></rect><rect x="54" y="22" width="4" height="8" rx="2" fill="#8FA1FF"></rect><rect x="74" y="22" width="4" height="8" rx="2" fill="#8FA1FF"></rect></g><circle cx="50" cy="70" r="7.5" fill="#FFFFFF" stroke="#C8D0F8" stroke-width="1.5"></circle><path d="M47 68 Q48 67 49 68" stroke="#5A5A7A" stroke-width="1.4" fill="none" stroke-linecap="round"></path><path d="M51 68 Q52 67 53 68" stroke="#5A5A7A" stroke-width="1.4" fill="none" stroke-linecap="round"></path><path d="M47.5 71 C 49 72.5, 51 72.5, 52.5 71" stroke="#FF6B9D" stroke-width="1.5" fill="none" stroke-linecap="round"></path></g>`,1)])],8,Ut))}},Ht=["width","height"],Yt={__name:"OtherIcon",props:{size:{type:[Number,String],default:24}},setup(p){return(m,c)=>(i(),d("svg",{width:p.size,height:p.size,viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block",verticalAlign:"middle"}},[...c[0]||(c[0]=[lt('<g transform="translate(48 48) scale(1.18) translate(-48 -48)"><path d="M48 20 L52 36 L68 36 L56 46 L60 62 L48 52 L36 62 L40 46 L28 36 L44 36 Z" fill="#FFFFFF" stroke="#D4A3FF" stroke-width="2"></path><path d="M48 32 L49 40 L57 40 L51 44 L53 52 L48 48 L43 52 L45 44 L39 40 L47 40 Z" fill="#E8C5FF"></path><circle cx="44" cy="42" r="2" fill="#B47FFF"></circle><circle cx="52" cy="42" r="2" fill="#B47FFF"></circle><path d="M46 46 C 47 49, 49 49, 50 46" stroke="#FF6B9D" stroke-width="2" fill="none" stroke-linecap="round"></path><circle cx="30" cy="30" r="2" fill="#E8C5FF"></circle><circle cx="66" cy="30" r="2" fill="#E8C5FF"></circle><circle cx="30" cy="66" r="2" fill="#E8C5FF"></circle><circle cx="66" cy="66" r="2" fill="#E8C5FF"></circle></g>',1)])],8,Ht))}};function Vt(p,m){const c=String(m).trim()?String(m).trim():"ç§‹ç‘¾";switch(p){case"toilet":return c+"åˆæ‹‰ç²‘ç²‘å•¦ï½";case"meal":return c+"çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½";case"fitness":return c+"å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½";default:return c+"çœŸæ£’ï½"}}function Zt(){try{typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(15)}catch{}}const Ot={class:"punch-success-wave-wrap","aria-hidden":"true"},Kt={class:"punch-success-wave punch-success-wave--main"},qt={class:"punch-success-wave punch-success-wave--mirror"},Wt={class:"punch-success-message"},j=25,kt=.08,Gt={__name:"PunchSuccessModal",props:{open:Boolean,punchType:{type:String,default:"fitness"},message:{type:String,default:""},unlockedAudioContext:{type:Object,default:null}},emits:["update:open"],setup(p,{emit:m}){const c="./".replace(/\/*$/,"")+"/",ot={toilet:1,meal:1.5,fitness:1.5,other:1},q={toilet:"paomo",meal:"food",fitness:"fitness",other:"paomo"};function it(a){const l=q[a]||"paomo",u=l==="paomo"?"music2.lrc":`music_${l}.lrc`;return{sound:c+`music_${l}.mp3`,lrc:c+u}}const b=p,Y=m,W=g({get:()=>b.open,set:a=>Y("update:open",a)}),D=_(Array(j).fill(kt)),G=_(null),M=_([]),Q=g(()=>M.value.map(a=>a.text)),S=_(-1);let T=null,C=null,I=null,v=null,h=null,x=null;function z(a){const l=a.split(`
`),u=[];for(const t of l){const r=t.trim();if(!r||/^\[(ti|ar|al|by|offset):/i.test(r))continue;const E=/\[(\d+):(\d+(?:\.\d+)?)\]/g;let w;const F=[];let P=0;for(;(w=E.exec(r))!==null;){const Z=Number(w[1]||0),tt=Number(w[2]||0);F.push(Z*60+tt),P=E.lastIndex}if(!F.length)continue;const L=r.slice(P).trim();L&&F.forEach(Z=>{u.push({time:Z,text:L})})}return u.sort((t,r)=>t.time-r.time),u}async function J(a){if(a)try{const l=await fetch(a);if(!l.ok)return;const u=await l.text();M.value=z(u)}catch{M.value=[]}}function $(){if(I!=null&&(cancelAnimationFrame(I),I=null),v){try{v.disconnect()}catch{}v=null}D.value=Array(j).fill(.08),h!=null&&(clearInterval(h),h=null),S.value=-1,x=null}function A(){if(!C)return;const a=new Uint8Array(C.frequencyBinCount);C.getByteFrequencyData(a);const l=j,u=Math.max(1,Math.floor(a.length/l)),t=[];for(let r=0;r<l;r++){let E=0;const w=r*u,F=Math.min(w+u,a.length);for(let L=w;L<F;L++)E+=a[L];const P=E/(F-w);t.push(Math.min(1,P/255*1.2+.08))}D.value=t,I=requestAnimationFrame(A)}function ct(){if(!T||!M.value.length)return;x=T.currentTime,h!=null&&(clearInterval(h),h=null);const a=()=>{if(!T||x==null)return;const l=T.currentTime-x;if(l<0)return;const u=M.value;let t=u.length-1;for(let r=0;r<u.length&&u[r].time<=l;r++)t=r;t!==S.value&&(S.value=t)};a(),h=setInterval(a,200)}vt(S,async()=>{await bt();const a=G.value;if(!a)return;const l=a.querySelector(".punch-success-lyric-line--active");l&&l.scrollIntoView({block:"center",behavior:"auto"})});async function X(){$();try{const{sound:a,lrc:l}=it(b.punchType),u=window.AudioContext||window.webkitAudioContext,t=b.unlockedAudioContext&&b.unlockedAudioContext.state!=="closed"?b.unlockedAudioContext:T||new u;T=t,t.state==="suspended"&&await t.resume(),await J(l);const E=await(await fetch(a)).arrayBuffer(),w=await t.decodeAudioData(E);v=t.createBufferSource(),v.buffer=w,C=t.createAnalyser(),C.fftSize=256,C.smoothingTimeConstant=.7;const F=t.createGain();F.gain.value=ot[b.punchType]??1,v.connect(C),C.connect(F),F.connect(t.destination),v.onended=()=>$(),v.start(0),A(),ct()}catch{D.value=Array(j).fill(kt)}}vt(()=>b.open,a=>{a?X():$()},{immediate:!0}),gt($);function V(){Y("update:open",!1)}return(a,l)=>{const u=_t;return i(),O(Dt,{open:W.value,"onUpdate:open":l[0]||(l[0]=t=>W.value=t),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:K(()=>[l[2]||(l[2]=n("div",{class:"punch-success-header"},[n("span",{class:"punch-success-label"},"æ‰“å¡æˆåŠŸ")],-1)),n("div",Ot,[n("div",Kt,[(i(),d(N,null,H(j,t=>n("span",{key:"main-"+t,class:"wave-bar",style:yt({transform:`scaleY(${D.value[t-1]})`})},null,4)),64))]),n("div",qt,[(i(),d(N,null,H(j,t=>n("span",{key:"mirror-"+t,class:"wave-bar wave-bar--mirror",style:yt({transform:`scaleY(${D.value[t-1]})`})},null,4)),64))])]),n("div",Wt,y(p.message),1),Q.value.length?(i(),d("div",{key:0,class:"punch-success-lyrics",ref_key:"lyricsContainerRef",ref:G},[(i(!0),d(N,null,H(Q.value,(t,r)=>(i(),d("p",{key:r,class:st(["punch-success-lyric-line",{"punch-success-lyric-line--active":r===S.value}])},y(t),3))),128))],512)):nt("",!0),ht(u,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:V},{default:K(()=>[...l[1]||(l[1]=[at("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},Qt=St(Gt,[["__scopeId","data-v-e3459e69"]]),Jt={class:"tab-panel active punch-panel"},Xt={class:"app-header"},te={class:"stats-row"},ee={class:"stat-card"},se={class:"stat-value"},ne={class:"stat-card"},ae={class:"stat-value"},le={class:"stat-value"},oe={key:0,class:"stat-achievement-hint"},ie={class:"app-main"},ce={class:"type-section","aria-label":"é€‰æ‹©ç±»å‹"},re={class:"type-tab-title"},ue={class:"type-tab-text"},de={class:"punch-button-inner"},pe={class:"punch-icon","aria-hidden":"true"},he={key:0,class:"last-punch"},me={class:"last-punch-type"},fe={class:"last-punch-date"},ve={key:1,class:"last-punch"},ye={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},Fe={class:"heatmap-container"},we={class:"heatmap-grid"},ke={key:0,class:"heatmap-cell heatmap-cell-empty"},ge=["title"],_e="fitness",Ce="ç§‹ç‘¾",xe=450,De={__name:"PunchView",setup(p){var ft;const{records:m,todayCount:c,streak:ot,lastRecord:q,addRecord:it,getMonthHeatmap:b}=At(),{unlockedList:Y,achievements:W,checkAll:D}=Et(),{shouldSkipDueToDoubleTap:G}=Tt(),M=pt("openAchievementModal",()=>{}),Q=pt("showAchievementToast",()=>{}),S=pt("userName",_("")),T=["toilet","meal","fitness","other"],C=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],I=[{threshold:6,class:"heatmap-cell-4"},{threshold:4,class:"heatmap-cell-3"},{threshold:2,class:"heatmap-cell-2"},{threshold:1,class:"heatmap-cell-1"}],v=[{type:"toilet",label:"å¦‚å•",emoji:"ğŸš½",short:"å•",tint:"#4caf50",iconComponent:zt},{type:"meal",label:"é¥­å¦",emoji:"ğŸš",short:"é¥­",tint:"#ff9800",iconComponent:Rt},{type:"fitness",label:"å¥èº«",emoji:"ğŸ’ª",short:"èº«",tint:"#2196f3",iconComponent:jt},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0",iconComponent:Yt}].map(e=>({...e,tabTitle:`${e.emoji} ${e.short}`})),h=_(T.includes((ft=q.value)==null?void 0:ft.type)?q.value.type:_e),x=_(!1),z=_(!1),J=_("fitness"),$=_(""),A=_(null),ct=g(()=>new Map(W.map(e=>[e.id,e]))),X=g(()=>{var f;const e=Y.value;if(!e.length)return"";const s=e[e.length-1];return((f=ct.value.get(s))==null?void 0:f.title)??""}),V=g(()=>v.find(e=>e.type===h.value)||v[0]),a=g(()=>c.value===0),l=g(()=>[`punch-button--${h.value}`,{"punch-button-bounce":x.value,"punch-button--first":a.value}]),u=g(()=>{var e;return`${((e=V.value)==null?void 0:e.label)||""} æ‰“æˆ‘`}),t=g(()=>{if(c.value===0)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const e=wt().format("YYYY-MM-DD"),s=m.value.filter(k=>k.dateKey===e);if(!s.length)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const f=s.reduce((k,o)=>o.timestamp>k.timestamp?o:k),B=v.find(k=>k.type===(f.type||"other"));return{hasRecord:!0,typeLabel:(B==null?void 0:B.label)??"å…¶ä»–",dateDisplay:Mt(f.dateKey),timeDisplay:Bt(f.timestamp)}}),r=g(()=>wt()),E=g(()=>{const e=r.value,s=e.year(),f=e.month()+1,B=b(m.value,s,f),k=e.startOf("month"),o=k.daysInMonth(),rt=k.day(),ut=[];for(let R=0;R<rt;R++)ut.push({empty:!0});for(let R=1;R<=o;R++){const dt=`${s}-${String(f).padStart(2,"0")}-${String(R).padStart(2,"0")}`,et=B[dt]||0,Ct=F(et),xt=et?`${dt} æ‰“æˆ‘ ${et} æ¬¡`:dt;ut.push({empty:!1,count:et,level:Ct,title:xt})}return ut});function w(e){return e==="meal"?28:24}function F(e){const s=I.find(f=>e>=f.threshold);return(s==null?void 0:s.class)??"heatmap-cell-0"}function P(){var e;return((e=S.value)==null?void 0:e.trim())||Ce}function L(){m.value=[...m.value]}function Z(){if(G(h.value))return;Zt();const e=window.AudioContext||window.webkitAudioContext;e&&((!A.value||A.value.state==="closed")&&(A.value=new e),A.value.state==="suspended"&&A.value.resume());const s=P();J.value=h.value,$.value=Vt(h.value,s),z.value=!0,it(h.value),x.value=!0,requestAnimationFrame(()=>{x.value=!1,document.body.offsetHeight,x.value=!0,setTimeout(()=>{x.value=!1},xe)}),setTimeout(()=>{D(m.value).forEach(B=>Q(B))},0)}function tt(){document.visibilityState==="visible"&&L()}function mt(e){e.persisted&&L()}return Lt(()=>{document.addEventListener("visibilitychange",tt),window.addEventListener("pageshow",mt)}),gt(()=>{document.removeEventListener("visibilitychange",tt),window.removeEventListener("pageshow",mt)}),(e,s)=>{const f=Nt,B=$t,k=_t;return i(),d("div",Jt,[n("header",Xt,[n("div",te,[n("div",ee,[n("span",se,y(U(c)),1),s[3]||(s[3]=n("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),n("div",ne,[n("span",ae,y(U(ot)),1),s[4]||(s[4]=n("span",{class:"stat-label"},"è¿ç»­",-1))]),n("div",{class:"stat-card stat-card-achievement",onClick:s[0]||(s[0]=(...o)=>U(M)&&U(M)(...o))},[n("span",le,y(U(Y).length),1),s[5]||(s[5]=n("span",{class:"stat-label"},"æˆå°±",-1)),X.value?(i(),d("span",oe,y(X.value),1)):nt("",!0)])])]),n("main",ie,[n("section",ce,[ht(B,{active:h.value,"onUpdate:active":s[1]||(s[1]=o=>h.value=o),shrink:""},{default:K(()=>[(i(!0),d(N,null,H(U(v),o=>(i(),O(f,{key:o.type,name:o.type},{title:K(()=>[n("span",re,[(i(),O(Ft(o.iconComponent),{size:w(o.type)},null,8,["size"])),n("span",ue,y(o.short),1)])]),_:2},1032,["name"]))),128))]),_:1},8,["active"])]),n("section",{class:st(["punch-section",{"punch-section--first":a.value}]),"aria-label":"æ‰“å¡"},[ht(k,{type:"primary",round:"",size:"large",class:st(["punch-button",l.value]),"aria-label":u.value,onClick:Z},{default:K(()=>[n("span",de,[n("span",pe,[V.value?(i(),O(Ft(V.value.iconComponent),{key:0,size:40})):nt("",!0)]),s[6]||(s[6]=n("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),t.value.hasRecord?(i(),d("p",he,[s[7]||(s[7]=at(" ä¸Šæ¬¡æ˜¯ ",-1)),n("span",me,y(t.value.typeLabel),1),s[8]||(s[8]=at(" ï½ ",-1)),n("span",fe,y(t.value.dateDisplay),1),at(" "+y(t.value.timeDisplay),1)])):(i(),d("p",ve,y(t.value.text),1))],2),n("section",ye,[s[9]||(s[9]=n("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),n("div",Fe,[n("div",we,[(i(),d(N,null,H(C,o=>n("span",{key:o,class:"heatmap-week-label"},y(o),1)),64)),(i(!0),d(N,null,H(E.value,(o,rt)=>(i(),d(N,{key:rt},[o.empty?(i(),d("span",ke)):(i(),d("span",{key:1,class:st(["heatmap-cell",o.level]),title:o.title},y(o.count||""),11,ge))],64))),128))])])])]),z.value?(i(),O(Qt,{key:0,open:z.value,"onUpdate:open":s[2]||(s[2]=o=>z.value=o),"punch-type":J.value,message:$.value,"unlocked-audio-context":A.value},null,8,["open","punch-type","message","unlocked-audio-context"])):nt("",!0)])}}};export{De as default};
