import{i as te,o as l,c as U,w as B,a as t,t as i,d as q,B as G,e as w,r as D,h as M,Y as O,u as se,a6 as ae,j as c,l as u,F as b,k as H,n as z,m as ne,ai as W,aj as oe,ak as le,G as ie}from"./index-DxUjHE30.js";/* empty css              */import{u as ce}from"./useAchievements-DOEuUTSP.js";import{u as ue}from"./useDoubleTapHint-B3pbvMAm.js";import{_ as re}from"./BaseModal-CTNVJOyi.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as de,a as me}from"./index-C_xnnFKP.js";import"./use-id-R6PMLyS-.js";function he(_){switch(_){case"toilet":return"ç§‹ç‘¾åˆæ‹‰ç²‘ç²‘å•¦ï½ž";case"meal":return"ç§‹ç‘¾çœŸä¹–ï¼Œåƒé¥­é¦™é¦™ï½ž";case"fitness":return"ç§‹ç‘¾å¨æ­¦ï¼ŒèŒå£®æˆé•¿ï½ž";default:return"ç§‹ç‘¾çœŸæ£’ï½ž"}}const fe={class:"punch-success-message"},ve={__name:"PunchSuccessModal",props:{open:Boolean,message:{type:String,default:""}},emits:["update:open"],setup(_,{emit:d}){const m=_,S=d,r=M({get:()=>m.open,set:o=>S("update:open",o)}),h=D(null),x=["â™¥","âœ¨","â˜…","â˜†","â€¢","â™¥","âœ¨","â˜…"],C=["celebrate-float","celebrate-twinkle","celebrate-rise"],j=["#ff6b9d","#e84c7a","#ffd700","#ffb347","#c2185b","#f8bbd9"];function k(){if(h.value){h.value.innerHTML="";for(let o=0;o<28;o++){const a=document.createElement("span");a.className="celebrate-item "+C[o%C.length],a.textContent=x[o%x.length],a.style.left=Math.random()*80+10+"%",a.style.top=Math.random()*80+10+"%",a.style.animationDelay=Math.random()*.8+"s",a.style.color=j[o%j.length],a.style.fontSize=12+Math.random()*12+"px",h.value.appendChild(a)}}}function P(){O(()=>{requestAnimationFrame(()=>{O(()=>{k(),setTimeout(k,80)})})})}function I(){S("update:open",!1)}return te(()=>m.open,o=>{o&&P()},{immediate:!0}),(o,a)=>{const f=G;return l(),U(re,{open:r.value,"onUpdate:open":a[0]||(a[0]=L=>r.value=L),"show-close":!1,"inner-class":"punch-success-modal-inner"},{default:B(()=>[t("div",{ref_key:"celebrationRef",ref:h,class:"punch-success-celebration","aria-hidden":"true"},null,512),t("div",fe,i(_.message),1),q(f,{type:"primary",block:"",round:"",class:"punch-success-btn",onClick:I},{default:B(()=>[...a[1]||(a[1]=[w("å¥½å“’",-1)])]),_:1})]),_:1},8,["open"])}}},ye=pe(ve,[["__scopeId","data-v-4d06afb7"]]),be={class:"tab-panel active punch-panel"},_e={class:"app-header"},ke={class:"stats-row"},ge={class:"stat-card"},Te={class:"stat-value"},we={class:"stat-card"},De={class:"stat-value"},Me={class:"stat-value"},Se={class:"app-main"},xe={class:"type-section","aria-label":"é€‰æ‹©ç±»åž‹"},Ce={class:"punch-button-inner"},je={class:"punch-icon","aria-hidden":"true"},Le={class:"last-punch"},Re={class:"last-punch-type"},Ae={class:"last-punch-date"},$e={class:"heatmap-section","aria-label":"æœ¬æœˆæ‰“æˆ‘"},Be={class:"heatmap-container"},Pe={class:"heatmap-grid"},Ee={key:0,class:"heatmap-cell heatmap-cell-empty"},Ne=["title"],Oe={__name:"PunchView",setup(_){var K;const{records:d,todayCount:m,streak:S,lastRecord:r,addRecord:h,getMonthHeatmap:x}=se(),{unlockedList:C,checkAll:j}=ce(),k=W("openAchievementModal",()=>{}),P=W("showAchievementToast",()=>{}),o=D(["toilet","meal","fitness","other"].includes((K=r.value)==null?void 0:K.type)?r.value.type:"fitness"),a=D(!1),f=D(!1),L=D(""),{shouldSkipDueToDoubleTap:Y}=ue(),R=[{type:"toilet",label:"å¦‚åŽ•",emoji:"ðŸš½",short:"åŽ•",tint:"#4caf50"},{type:"meal",label:"é¥­å¦",emoji:"ðŸš",short:"é¥­",tint:"#ff9800"},{type:"fitness",label:"å¥èº«",emoji:"ðŸ’ª",short:"èº«",tint:"#2196f3"},{type:"other",label:"å…¶ä»–",emoji:"âœ¨",short:"å…¶",tint:"#9c27b0"}].map(s=>({...s,tabTitle:s.emoji+" "+s.short})),A=M(()=>R.find(s=>s.type===o.value)||R[0]);function J(s){var e;return((e=R.find(v=>v.type===s))==null?void 0:e.label)??"å…¶ä»–"}const Q=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],g=M(()=>{if(!r.value)return{hasRecord:!1,text:"ä»Šå¤©è¿˜æ²¡æ‰“è¿‡æˆ‘å“¦"};const s=r.value;return{hasRecord:!0,typeLabel:J(s.type||"other"),dateDisplay:le(s.dateKey),timeDisplay:oe(s.timestamp)}}),X=M(()=>ie()),Z=M(()=>{const s=X.value,e=s.year(),v=s.month()+1,E=x(d.value,e,v),$=s.startOf("month"),n=$.daysInMonth(),N=$.day(),V=[];for(let y=0;y<N;y++)V.push({empty:!0});for(let y=1;y<=n;y++){const F=`${e}-${String(v).padStart(2,"0")}-${String(y).padStart(2,"0")}`,p=E[F]||0;let T="heatmap-cell-0";p>=6?T="heatmap-cell-4":p>=4?T="heatmap-cell-3":p>=2?T="heatmap-cell-2":p>=1&&(T="heatmap-cell-1"),V.push({empty:!1,count:p,level:T,title:p?`${F} æ‰“æˆ‘ ${p} æ¬¡`:F})}return V});function ee(){Y(o.value)||(L.value=he(o.value),f.value=!0,h(o.value),a.value=!0,requestAnimationFrame(()=>{a.value=!1,document.body.offsetHeight,a.value=!0,setTimeout(()=>a.value=!1,450)}),setTimeout(()=>{j(d.value).forEach(e=>P(e))},0))}return ae(()=>{const s=()=>{d.value=[...d.value]};document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&s()}),window.addEventListener("pageshow",e=>{e.persisted&&s()})}),(s,e)=>{const v=me,E=de,$=G;return l(),c("div",be,[t("header",_e,[t("div",ke,[t("div",ge,[t("span",Te,i(u(m)),1),e[3]||(e[3]=t("span",{class:"stat-label"},"ä»Šæ—¥",-1))]),t("div",we,[t("span",De,i(u(S)),1),e[4]||(e[4]=t("span",{class:"stat-label"},"è¿žç»­",-1))]),t("div",{class:"stat-card stat-card-achievement",onClick:e[0]||(e[0]=(...n)=>u(k)&&u(k)(...n))},[t("span",Me,i(u(C).length),1),e[5]||(e[5]=t("span",{class:"stat-label"},"æˆå°±",-1))])])]),t("main",Se,[t("section",xe,[q(E,{active:o.value,"onUpdate:active":e[1]||(e[1]=n=>o.value=n),shrink:""},{default:B(()=>[(l(!0),c(b,null,H(u(R),n=>(l(),U(v,{key:n.type,name:n.type,title:n.tabTitle},null,8,["name","title"]))),128))]),_:1},8,["active"])]),t("section",{class:z(["punch-section",{"punch-section--first":u(m)===0}])},[q($,{type:"primary",round:"",size:"large",class:z(["punch-button",["punch-button--"+o.value,{"punch-button-bounce":a.value},{"punch-button--first":u(m)===0}]]),"aria-label":A.value?A.value.emoji+" æ‰“æˆ‘":"æ‰“æˆ‘",onClick:ee},{default:B(()=>[t("span",Ce,[t("span",je,i(A.value?A.value.emoji:"ðŸ‘Š"),1),e[6]||(e[6]=t("span",{class:"punch-text"},"æ‰“æˆ‘",-1))])]),_:1},8,["class","aria-label"]),t("p",Le,[g.value.hasRecord?(l(),c(b,{key:0},[e[7]||(e[7]=w("ä¸Šæ¬¡æ˜¯ ",-1)),t("span",Re,i(g.value.typeLabel),1),e[8]||(e[8]=w(" ï½ž ",-1)),t("span",Ae,i(g.value.dateDisplay),1),w(" "+i(g.value.timeDisplay),1)],64)):(l(),c(b,{key:1},[w(i(g.value.text),1)],64))])],2),t("section",$e,[e[9]||(e[9]=t("h2",{class:"heatmap-title"},"æœ¬æœˆæ‰“æˆ‘",-1)),t("div",Be,[t("div",Pe,[(l(),c(b,null,H(Q,n=>t("span",{key:n,class:"heatmap-week-label"},i(n),1)),64)),(l(!0),c(b,null,H(Z.value,(n,N)=>(l(),c(b,{key:N},[n.empty?(l(),c("span",Ee)):(l(),c("span",{key:1,class:z(["heatmap-cell",n.level]),title:n.title},i(n.count||""),11,Ne))],64))),128))])])])]),f.value?(l(),U(ye,{key:0,open:f.value,"onUpdate:open":e[2]||(e[2]=n=>f.value=n),message:L.value},null,8,["open","message"])):ne("",!0)])}}};export{Oe as default};
